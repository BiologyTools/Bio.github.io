\hypertarget{ludl_8py_source}{}\doxysection{ludl.\+py}
\label{ludl_8py_source}\index{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/stages/ludl.py@{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/stages/ludl.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00001}00001 \textcolor{comment}{\#!/usr/bin/env python3}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00022}00022 \textcolor{stringliteral}{"{}"{}"{}Ludl controller.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00023}00023 \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00025}00025 \textcolor{keyword}{import} contextlib}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00026}00026 \textcolor{keyword}{import} threading}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00027}00027 \textcolor{keyword}{import} typing}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00028}00028 \textcolor{keyword}{import} time}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00029}00029 \textcolor{keyword}{import} serial}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00030}00030 \textcolor{keyword}{import} re}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00032}00032 \textcolor{keyword}{import} \mbox{\hyperlink{namespacemicroscope_1_1abc}{microscope.abc}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00036}00036 \textcolor{comment}{\# so far very basic support for stages}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00037}00037 \textcolor{comment}{\# no support for filter, shutters, or slide loader as I dont have hardware}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00039}00039 \textcolor{comment}{\# Note: }}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00040}00040 \textcolor{comment}{\# commands end in a '\(\backslash\)r' but replies return ending in '\(\backslash\)n'!}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00041}00041 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00042}00042 \textcolor{comment}{\# errors}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00043}00043 \textcolor{comment}{\# -\/1 Unknown command}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00044}00044 \textcolor{comment}{\# -\/2 Illegal point type or axis, or module not installed}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00045}00045 \textcolor{comment}{\# -\/3 Not enough parameters (e.g. move r=)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00046}00046 \textcolor{comment}{\# -\/4 Parameter out of range}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00047}00047 \textcolor{comment}{\# -\/21 Process aborted by HALT command}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00049}00049 \textcolor{comment}{\# Slide Loader:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00050}00050 \textcolor{comment}{\# -\/4 (parameter out of range) used for cassette or slot range errors}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00051}00051 \textcolor{comment}{\# -\/10 No slides selected}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00052}00052 \textcolor{comment}{\# -\/11 End of list reached}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00053}00053 \textcolor{comment}{\# -\/12 Slide error}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00054}00054 \textcolor{comment}{\# -\/16 Motor move error (move not completed successfully due to stall,}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00055}00055 \textcolor{comment}{\# end limit, etcâ€¦.)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00056}00056 \textcolor{comment}{\# -\/17 Initialization erro}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00058}00058 \textcolor{comment}{\#On startup the stage move to extremes to find limits and then sets}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00059}00059 \textcolor{comment}{\# the -\/ve limit on each axis to 0.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00061}00061 LUDL\_ERRORS = \{ -\/1: \textcolor{stringliteral}{'Unknown command'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00062}00062                 -\/2: \textcolor{stringliteral}{'Illegal point type or axis, or module not installed'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00063}00063                 -\/3: \textcolor{stringliteral}{'Not enough parameters (e.g. move r=)'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00064}00064                 -\/4: \textcolor{stringliteral}{'Parameter out of range'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00065}00065                 -\/21: \textcolor{stringliteral}{'Process aborted by HALT command'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00066}00066                 \textcolor{comment}{\# Slide Loader:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00067}00067                 \textcolor{comment}{\#-\/4:, (parameter out of range) used for cassette or slot range errors}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00068}00068                 -\/10: \textcolor{stringliteral}{'No slides selected'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00069}00069                 -\/11: \textcolor{stringliteral}{'End of list reached'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00070}00070                 -\/12: \textcolor{stringliteral}{'Slide error'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00071}00071                 -\/16: \textcolor{stringliteral}{'Motor move error (move not completed successfully due to stall, end limit, etc.'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00072}00072                 -\/17: \textcolor{stringliteral}{'Initialization error'},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00073}00073                \}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00075}00075 AXIS\_MAPPER = \{ 1: \textcolor{stringliteral}{'X'} ,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00076}00076                 2: \textcolor{stringliteral}{'Y'} ,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00077}00077                 3: \textcolor{stringliteral}{'Z'} ,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00078}00078                \}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00080}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller}{00080}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller}{\_LudlController}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00081}00081     \textcolor{stringliteral}{"{}"{}"{}Connection to a Ludl Controller and wrapper to its commands.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00082}00082 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00083}00083 \textcolor{stringliteral}{    Tested }\textcolor{keyword}{with} MC2000 controller \textcolor{keywordflow}{and} xy stage. }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00086}00086     This \textcolor{keyword}{class }also implements the logic to parse and validate}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00087}00087     commands so it can be shared between multiple devices.}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00088}00088     }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00089}00089     This \textcolor{keyword}{class }has only been tested on a MAC2000 controller from the}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00090}00090     1990\textcolor{stringliteral}{'s however newer controllers should be compatible.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00091}00091 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00092}00092 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00093}00093 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00094}00094 \textcolor{stringliteral}{    }\textcolor{keyword}{def }\_\_init\_\_(self, port: str, baudrate: int, timeout: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00095}00095         \textcolor{comment}{\# From the technical datasheet: 8 bit word 1 stop bit, no}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00096}00096         \textcolor{comment}{\# parity no handshake, baudrate options of 9600, 19200, 38400,}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00097}00097         \textcolor{comment}{\# 57600 and 115200.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00098}00098         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}} = serial.Serial(}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00099}00099             port=port,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00100}00100             baudrate=baudrate,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00101}00101             timeout=timeout,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00102}00102             bytesize=serial.EIGHTBITS,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00103}00103             stopbits=serial.STOPBITS\_TWO,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00104}00104             parity=serial.PARITY\_NONE,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00105}00105             xonxoff=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00106}00106             rtscts=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00107}00107             dsrdtr=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00108}00108         )}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00109}00109         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}} = threading.RLock()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00111}00111         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00112}00112             \textcolor{comment}{\# We do not use the general get\_description() here because}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00113}00113             \textcolor{comment}{\# if this is not a ProScan device it would never reach the}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00114}00114             \textcolor{comment}{\# '\(\backslash\)rEND\(\backslash\)r' that signals the end of the description.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00115}00115             \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00116}00116                 self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_add4a03d1c3ce094776f51d029f3cfed6}{command}}(b\textcolor{stringliteral}{'RCONFIG'})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00117}00117                 answer = self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a346c58743e240e6b9f6a738d3341147d}{read\_multiline}}()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00118}00118             \textcolor{keywordflow}{except}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00119}00119                 print(\textcolor{stringliteral}{"{}Unable to read configuration. Is Ludl connected?"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00120}00120                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00121}00121             \textcolor{comment}{\# parse config responce which tells us what devices are present}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00122}00122             \textcolor{comment}{\# on this controller.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00124}00124             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a4a124cc68762c5f469fb9a75eda8a702}{\_devlist}}=\{\}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00126}00126             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} answer[4:-\/1]:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00127}00127                 \textcolor{comment}{\#loop through lines 4 to second last one which are devices}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00128}00128                 \textcolor{comment}{\#present on this controller}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00129}00129                 devinfo=re.split(\textcolor{stringliteral}{r"{}\(\backslash\)s\{2,\}"{}},line.decode(\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00130}00130                 \textcolor{comment}{\# dev address,label,id,description, type}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00131}00131                 self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a4a124cc68762c5f469fb9a75eda8a702}{\_devlist}}[devinfo[0]]=devinfo[1:]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00133}00133 \textcolor{comment}{\#            print(answer)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00134}00134 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00135}00135 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00136}00136     \textcolor{keyword}{def }is\_busy(self):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00137}00137         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00138}00138 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00139}00139     \textcolor{keyword}{def }get\_number\_axes(self):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00140}00140         \textcolor{keywordflow}{return} 2}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00141}00141     }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00142}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_add4a03d1c3ce094776f51d029f3cfed6}{00142}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_add4a03d1c3ce094776f51d029f3cfed6}{command}}(self, command: bytes) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00143}00143         \textcolor{stringliteral}{"{}"{}"{}Send command to device."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00144}00144         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00145}00145             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.write(command + b\textcolor{stringliteral}{"{}\(\backslash\)r"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00147}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a8af5295bc32b54e0752b2ef132078ce9}{00147}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a8af5295bc32b54e0752b2ef132078ce9}{readline}}(self) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00148}00148         \textcolor{stringliteral}{"{}"{}"{}Read a line from the device connection until '\(\backslash\)n'."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00149}00149         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00150}00150             \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.read\_until(b\textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00151}00151 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00152}00152     \textcolor{keyword}{def }read\_multiline(self):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00153}00153         output=[]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00154}00154         line=\textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00155}00155         \textcolor{keywordflow}{while} (line):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00156}00156             line=self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a8af5295bc32b54e0752b2ef132078ce9}{readline}}()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00157}00157             output.append(line.strip())}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00158}00158             \textcolor{keywordflow}{if} line==b\textcolor{stringliteral}{'N'} \textcolor{keywordflow}{or} line[0:2] == b\textcolor{stringliteral}{':A'} :}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00159}00159                 \textcolor{comment}{\#thins means an end of command strings doesn require an}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00160}00160                 \textcolor{comment}{\#additional timeout before it returns }}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00161}00161                 \textcolor{keywordflow}{return} (output)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00162}00162             \textcolor{keywordflow}{elif} line[0] == b\textcolor{stringliteral}{'N'}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00163}00163                 \textcolor{comment}{\#this is an error string}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00164}00164                 error=line[2:].strip()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00165}00165                 raise(\textcolor{stringliteral}{'Ludl controller error: \%s,\%s'} \% (error,LUDL\_ERRORS[error]))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00166}00166         return(output)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00167}00167             }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00168}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a23900f80d4e878fcaaf9442c3cc00554}{00168}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a23900f80d4e878fcaaf9442c3cc00554}{read\_until\_timeout}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00169}00169         \textcolor{stringliteral}{"{}"{}"{}Read until timeout; used to clean buffer if in an unknown state."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00170}00170         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00171}00171             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.flushInput()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00172}00172             \textcolor{keywordflow}{while} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a8af5295bc32b54e0752b2ef132078ce9}{readline}}():}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00173}00173                 \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00174}00174 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00175}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a4975a305c046500ab17cbf0e3a58c92c}{00175}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a4975a305c046500ab17cbf0e3a58c92c}{wait\_until\_idle}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00176}00176         \textcolor{stringliteral}{"{}"{}"{}Keep sending the 'STATUS' comand until the respnce}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00177}00177 \textcolor{stringliteral}{        returns b'0\(\backslash\)r'} \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00178}00178 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a24d3230414e1805f2732ba36316dca3e}{\_command\_and\_validate}}(b'STATUS'}, b\textcolor{stringliteral}{"{}N"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00179}00179         }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00180}00180     \textcolor{keyword}{def }\_command\_and\_validate(self, command: bytes, expected: bytes) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00181}00181         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00182}00182             answer = self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(command)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00183}00183             \textcolor{keywordflow}{if} answer == b\textcolor{stringliteral}{':A \(\backslash\)n'} :}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00184}00184             \textcolor{comment}{\#wait for move to stop}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00185}00185                 while(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(b\textcolor{stringliteral}{'STATUS'}) != expected):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00186}00186                     time.sleep(0.01)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00187}00187             \textcolor{keywordflow}{return} answer}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00188}00188 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00189}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{00189}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(self, command: bytes) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00190}00190         \textcolor{stringliteral}{"{}"{}"{}Send get command and return the answer."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00191}00191         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00192}00192             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_add4a03d1c3ce094776f51d029f3cfed6}{command}}(command)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00193}00193             \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a8af5295bc32b54e0752b2ef132078ce9}{readline}}()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00194}00194 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00195}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_ab1e24e50e7aa74429aee6d9d1f11fc30}{00195}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_ab1e24e50e7aa74429aee6d9d1f11fc30}{move\_command}}(self, command: bytes) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00196}00196         \textcolor{stringliteral}{"{}"{}"{}Send a move command and check return value."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00197}00197         \textcolor{comment}{\# Movement commands respond with "{}:A \(\backslash\)n"{} but the move is then}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00198}00198         \textcolor{comment}{\# being performed.  The move is only finihsed once the}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00199}00199         \textcolor{comment}{\# "{}STATUS"{} command returns "{}N"{} rather than "{}B"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00200}00200         \textcolor{comment}{\#self.\_command\_and\_validate(command, b"{}N"{})}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00201}00201         \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00202}00202         \textcolor{comment}{\#actully beter to just issue the move command and rely on}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00203}00203         \textcolor{comment}{\#other process to check position}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00204}00204         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(command)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00205}00205         }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00206}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a72a9f751ad9cc80c5b9d0513707376b4}{00206}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a72a9f751ad9cc80c5b9d0513707376b4}{move\_by\_relative\_position}}(self, axis: bytes, delta: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00207}00207         \textcolor{stringliteral}{"{}"{}"{}Send a realtive movement command to stated axis"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00208}00208         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00209}00209         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_ab1e24e50e7aa74429aee6d9d1f11fc30}{move\_command}}(bytes(\textcolor{stringliteral}{'MOVREL \{0\}=\{1\}'}.format(axisname,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00210}00210                                                         str(delta)),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00211}00211         }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00212}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_abb81fc4a3d934780a0e1f16f2c1b4a57}{00212}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_abb81fc4a3d934780a0e1f16f2c1b4a57}{move\_to\_absolute\_position}}(self, axis: bytes, pos: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00213}00213         \textcolor{stringliteral}{"{}"{}"{}Send a realtive movement command to stated axis"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00214}00214         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00215}00215         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_ab1e24e50e7aa74429aee6d9d1f11fc30}{move\_command}}(bytes(\textcolor{stringliteral}{'MOVE \{0\}=\{1\}'}.format(axisname,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00216}00216                                                       str(pos)),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00217}00217     \textcolor{keyword}{def }move\_to\_limit(self,axis: bytes,speed: int):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00218}00218         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00219}00219         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(bytes(\textcolor{stringliteral}{'SPIN \{0\}=\{1\}'}.format(axisname,speed),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00220}00220 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00221}00221     \textcolor{keyword}{def }motor\_moving(self,axis: bytes) -\/> int:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00222}00222         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00223}00223         reply=self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(bytes(\textcolor{stringliteral}{'RDSTAT \{0\}'}.format(axisname),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00224}00224         flags=int(reply.strip()[3:])}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00225}00225         \textcolor{keywordflow}{return} (flags\&1)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00227}00227     \textcolor{keyword}{def }set\_speed(self, axis: bytes, speed: int) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00228}00228         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00229}00229         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(bytes(\textcolor{stringliteral}{'SPEED \{0\}=\{1\}'}.format(axisname,speed),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00230}00230 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00231}00231 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00232}00232     \textcolor{keyword}{def }wait\_for\_motor\_stop(self,axis: bytes):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00233}00233         while(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a57f567ba8dbb26f07e8584dfb9f09e2c}{motor\_moving}}(axis)):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00234}00234             time.sleep(0.1)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00235}00235             }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00236}00236 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00237}00237     \textcolor{keyword}{def }reset\_position(self, axis: bytes):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00238}00238         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00239}00239         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(bytes(\textcolor{stringliteral}{'HERE \{0\}=0'}.format(axisname),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00240}00240         }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00241}00241     \textcolor{keyword}{def }get\_absolute\_position(self, axis: bytes) -\/> float:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00242}00242         axisname=AXIS\_MAPPER[axis]}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00243}00243         position=self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa538b7e1ccab1e5b2980f6487179811a}{get\_command}}(bytes(\textcolor{stringliteral}{'WHERE \{0\}'}.format(axisname),\textcolor{stringliteral}{'ascii'}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00244}00244         \textcolor{keywordflow}{if} position[3:4]==b\textcolor{stringliteral}{'N'}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00245}00245             print(\textcolor{stringliteral}{"{}Error: \{0\} : \{1\}"{}}.format(position,}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00246}00246                                          LUDL\_ERRORS[int(position[4:6])]))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00247}00247         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00248}00248             \textcolor{keywordflow}{return} float(position.strip()[2:])}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00249}00249                                 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00250}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa5a22278bb4966a9855b709b50b8731c}{00250}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_aa5a22278bb4966a9855b709b50b8731c}{set\_command}}(self, command: bytes) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00251}00251         \textcolor{stringliteral}{"{}"{}"{}Send a set command and check return value."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00252}00252         \textcolor{comment}{\# Property type commands that set certain status respond with}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00253}00253         \textcolor{comment}{\# zero.  They respond with a zero even if there are invalid}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00254}00254         \textcolor{comment}{\# arguments in the command.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00255}00255         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a24d3230414e1805f2732ba36316dca3e}{\_command\_and\_validate}}(command, b\textcolor{stringliteral}{"{}0\(\backslash\)r"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00256}00256 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00257}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a34ac31f67b585435ffb69696e5dbeee6}{00257}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a34ac31f67b585435ffb69696e5dbeee6}{get\_description}}(self, command: bytes) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00258}00258         \textcolor{stringliteral}{"{}"{}"{}Send a get description command and return it."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00259}00259         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a6a18e68911832135c4144e74eeb4e0e9}{\_lock}}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00260}00260             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_add4a03d1c3ce094776f51d029f3cfed6}{command}}(command)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00261}00261             \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.read\_until(b\textcolor{stringliteral}{"{}\(\backslash\)rEND\(\backslash\)r"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00263}00263     \textcolor{preprocessor}{@contextlib.contextmanager}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00264}00264     \textcolor{keyword}{def }changed\_timeout(self, new\_timeout: float):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00265}00265         previous = self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.timeout}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00266}00266         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00267}00267             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.timeout = new\_timeout}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00268}00268             \textcolor{keywordflow}{yield}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00269}00269         \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00270}00270             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller_a75237abe8fb3f00e9c447be58e06edfb}{\_serial}}.timeout = previous}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00271}00271 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00273}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis}{00273}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis}{\_LudlStageAxis}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis}{microscope.abc.StageAxis}}):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00274}00274     \textcolor{keyword}{def }\_\_init\_\_(self, dev\_conn: \_LudlController, axis: str) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00275}00275         super().\_\_init\_\_()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00276}00276         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}} = dev\_conn}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00277}00277         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}} = axis}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00278}00278         \textcolor{comment}{\# not a good solution as min/max are used to build the stage map in}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00279}00279         \textcolor{comment}{\# mosaic etc... Maybe we just need to know it! }}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00280}00280         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a0273d79dff0e810305675b45a48c9299}{min\_limit}} = 0.0}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00281}00281         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a964df8d7083134cb45ebcf54d045ea24}{max\_limit}} = 100000.0}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00282}00282         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a08450add0e35aaed4277e4564a0eaf0c}{set\_speed}}(100000)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00283}00283 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00284}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a3247c605c276fe72e3e0cd9e44cac8c8}{00284}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a3247c605c276fe72e3e0cd9e44cac8c8}{move\_by}}(self, delta: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00285}00285         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.move\_by\_relative\_position(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}}, int(delta))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00287}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a12cf3dee41dd65b008a005eea13ac05f}{00287}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a12cf3dee41dd65b008a005eea13ac05f}{move\_to}}(self, pos: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00288}00288         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.move\_to\_absolute\_position(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}}, int(pos))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00289}00289 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00290}00290     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00291}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a014a41eec051a20a3b2cf125c0e845ec}{00291}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a014a41eec051a20a3b2cf125c0e845ec}{position}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00292}00292         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.is\_busy():}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00293}00293             \_logger.warning(\textcolor{stringliteral}{"{}querying stage axis position but device is busy"{}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00294}00294             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.wait\_until\_idle()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00295}00295         \textcolor{keywordflow}{return} float(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.get\_absolute\_position(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}}))}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00296}00296 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00297}00297     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00298}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a7f17397b728c325edec168527bee8fd7}{00298}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a7f17397b728c325edec168527bee8fd7}{limits}}(self) -\/> microscope.AxisLimits:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00299}00299         \textcolor{keywordflow}{return} \mbox{\hyperlink{classmicroscope_1_1_axis_limits}{microscope.AxisLimits}}(lower=self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a0273d79dff0e810305675b45a48c9299}{min\_limit}}, upper=self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a964df8d7083134cb45ebcf54d045ea24}{max\_limit}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00300}00300 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00301}00301  \textcolor{comment}{\#   def speed(self) -\/> int:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00302}00302  \textcolor{comment}{\#       return self.speed}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00303}00303 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00304}00304     }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00305}00305     \textcolor{keyword}{def }home(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00306}00306         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_aad42c7589762a13a1fb49f23f470ba98}{find\_limits}}()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00307}00307         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a14b522d41fec9cc65afb5a8297ead8c1}{move\_to}}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a12cf3dee41dd65b008a005eea13ac05f}{move\_to}}(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a964df8d7083134cb45ebcf54d045ea24}{max\_limit}}/2)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00308}00308 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00309}00309     \textcolor{keyword}{def }set\_speed(self, speed: int) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00310}00310         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a9dffc71caa3ad46e8e7b74462c43491b}{speed}} = speed}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00311}00311         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.set\_speed(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}}, speed)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00312}00312 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00313}00313     \textcolor{keyword}{def }find\_limits(self,speed = 100000):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00314}00314         \textcolor{comment}{\#drive axis to minimum pos, zero and then drive to max position}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00315}00315         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.move\_to\_limit(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}},-\/speed)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00316}00316         \textcolor{comment}{\# spin moves dont set the status info need to query the motor}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00317}00317         \textcolor{comment}{\# status byte}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00318}00318         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.wait\_for\_motor\_stop(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00319}00319         \textcolor{comment}{\# reset positon to zero.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00320}00320         print(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a9bd5dbb04c2cb24282ff839d82e2acf3}{position}}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a014a41eec051a20a3b2cf125c0e845ec}{position}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00321}00321         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.reset\_position(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00322}00322         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a0273d79dff0e810305675b45a48c9299}{min\_limit}}=0.0}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00323}00323         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.homed = \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00324}00324         \textcolor{comment}{\# move to positive limit}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00325}00325         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.move\_to\_limit(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}},speed)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00326}00326         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a36b6c72a86c0d73e377950894805106b}{\_dev\_conn}}.wait\_for\_motor\_stop(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a334b7021184e98b0570c30f3b89c8ecb}{\_axis}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00327}00327         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a964df8d7083134cb45ebcf54d045ea24}{max\_limit}}=self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a9bd5dbb04c2cb24282ff839d82e2acf3}{position}}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a014a41eec051a20a3b2cf125c0e845ec}{position}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00328}00328         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a538a855a503270a2f367d1ba6e9b0274}{limits}}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis_a7f17397b728c325edec168527bee8fd7}{limits}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00329}00329 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00330}00330 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00331}00331     }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00332}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage}{00332}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage}{\_LudlStage}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage}{microscope.abc.Stage}}):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00333}00333     \textcolor{keyword}{def }\_\_init\_\_(}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00334}00334         self, conn: \_LudlController, **kwargs}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00335}00335     ) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00336}00336         super().\_\_init\_\_(**kwargs)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00337}00337         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a98f6d3db60da45cc6e42ba051d3d3225}{\_dev\_conn}} = conn}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00338}00338         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a34f1a5518bc83a5c9beaee4377c1d2e3}{\_axes}} = \{}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00339}00339             str(i): \mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_axis}{\_LudlStageAxis}}(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a98f6d3db60da45cc6e42ba051d3d3225}{\_dev\_conn}}, i)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00340}00340             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, 3)\textcolor{comment}{\#self.\_dev\_conn.get\_number\_axes() + 1)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00341}00341         \}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00342}00342         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a7e58bd8f985215fb5549552656c4e54d}{homed}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00343}00343 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00344}00344     \textcolor{keyword}{def }\_do\_shutdown(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00345}00345         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00346}00346 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00347}00347     \textcolor{keyword}{def }\_do\_enable(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00348}00348         \textcolor{comment}{\# Before a device can moved, it first needs to establish a}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00349}00349         \textcolor{comment}{\# reference to the home position.  We won't be able to move}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00350}00350         \textcolor{comment}{\# unless we home it first.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00351}00351         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.homed:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00352}00352             axes=self.axes}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00353}00353             \textcolor{keywordflow}{for} axis \textcolor{keywordflow}{in} axes:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00354}00354                 self.axes[axis].home()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00355}00355             self.homed = \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00356}00356         \textcolor{keywordflow}{return} \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00357}00357 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00358}00358 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00359}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_af736f9458ad0ea58992b8779f5936e59}{00359}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_af736f9458ad0ea58992b8779f5936e59}{may\_move\_on\_enable}}(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00360}00360         \textcolor{keywordflow}{return} \textcolor{keywordflow}{not} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a7e58bd8f985215fb5549552656c4e54d}{homed}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00361}00361 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00362}00362 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00363}00363     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00364}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a6f4a0400521692c019cf3095968aae98}{00364}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a6f4a0400521692c019cf3095968aae98}{axes}}(self) -\/> typing.Mapping[str, microscope.abc.StageAxis]:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00365}00365         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a34f1a5518bc83a5c9beaee4377c1d2e3}{\_axes}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00366}00366 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00367}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_abcbd10b185fb7a41db21988b4f8ca94d}{00367}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_abcbd10b185fb7a41db21988b4f8ca94d}{move\_by}}(self, delta: typing.Mapping[str, float]) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00368}00368         \textcolor{stringliteral}{"{}"{}"{}Move specified axes by the specified distance. "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00369}00369         \textcolor{keywordflow}{for} axis\_name, axis\_delta \textcolor{keywordflow}{in} delta.items():}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00370}00370             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a98f6d3db60da45cc6e42ba051d3d3225}{\_dev\_conn}}.move\_by\_relative\_position(}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00371}00371                 int(axis\_name), int(axis\_delta),}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00372}00372             )}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00373}00373         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a98f6d3db60da45cc6e42ba051d3d3225}{\_dev\_conn}}.wait\_until\_idle()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00374}00374 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00375}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a4b63a6c124822faad762eeb8886f229f}{00375}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a4b63a6c124822faad762eeb8886f229f}{move\_to}}(self, position: typing.Mapping[str, float]) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00376}00376         \textcolor{stringliteral}{"{}"{}"{}Move specified axes by the specified distance. "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00377}00377         print(position)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00378}00378         \textcolor{keywordflow}{for} axis\_name, axis\_position \textcolor{keywordflow}{in} position.items():}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00379}00379             self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a98f6d3db60da45cc6e42ba051d3d3225}{\_dev\_conn}}.move\_to\_absolute\_position(}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00380}00380                 int(axis\_name), int(axis\_position),}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00381}00381             )}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00382}00382         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage_a98f6d3db60da45cc6e42ba051d3d3225}{\_dev\_conn}}.wait\_until\_idle()}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00383}00383 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00384}00384 \textcolor{comment}{\#    def assert\_filterwheel\_number(self, number: int) -\/> None:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00385}00385 \textcolor{comment}{\#        assert number > 0 and number < 4}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00386}00386 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00387}00387 \textcolor{comment}{\#    def \_has\_thing(self, command: bytes, expected\_start: bytes) -\/> bool:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00388}00388 \textcolor{comment}{\#        \# Use the commands that returns a description string to find}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00389}00389 \textcolor{comment}{\#        \# whether a specific device is connected.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00390}00390 \textcolor{comment}{\#        with self.\_lock:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00391}00391 \textcolor{comment}{\#            description = self.get\_description(command)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00392}00392 \textcolor{comment}{\#            if not description.startswith(expected\_start):}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00393}00393 \textcolor{comment}{\#                self.read\_until\_timeout()}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00394}00394 \textcolor{comment}{\#                raise RuntimeError(}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00395}00395 \textcolor{comment}{\#                    "{}Failed to get description '\%s' (got '\%s')"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00396}00396 \textcolor{comment}{\#                    \% (command.decode(), description.decode())}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00397}00397 \textcolor{comment}{\#                )}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00398}00398 \textcolor{comment}{\#        return not description.startswith(expected\_start + b"{}NONE\(\backslash\)r"{})}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00399}00399 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00400}00400     \textcolor{comment}{\# def has\_filterwheel(self, number: int) -\/> bool:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00401}00401     \textcolor{comment}{\#     self.assert\_filterwheel\_number(number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00402}00402     \textcolor{comment}{\#     \# We use the 'FILTER w' command to check if there's a filter}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00403}00403     \textcolor{comment}{\#     \# wheel instead of the '?' command.  The reason is that the}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00404}00404     \textcolor{comment}{\#     \# third filter wheel, named "{}A AXIS"{} on the controller box and}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00405}00405     \textcolor{comment}{\#     \# "{}FOURTH"{} on the output of the '?' command, can be used for}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00406}00406     \textcolor{comment}{\#     \# non filter wheels.  We hope that 'FILTER 3' will fail}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00407}00407     \textcolor{comment}{\#     \# properly if what is connected to "{}A AXIS"{} is not a filter}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00408}00408     \textcolor{comment}{\#     \# wheel.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00409}00409     \textcolor{comment}{\#     return self.\_has\_thing(b"{}FILTER \%d"{} \% number, b"{}FILTER\_\%d = "{} \% number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00410}00410 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00411}00411     \textcolor{comment}{\# def get\_n\_filter\_positions(self, number: int) -\/> int:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00412}00412     \textcolor{comment}{\#     self.assert\_filterwheel\_number(number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00413}00413     \textcolor{comment}{\#     answer = self.get\_command(b"{}FPW \%d"{} \% number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00414}00414     \textcolor{comment}{\#     return int(answer)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00415}00415 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00416}00416     \textcolor{comment}{\# def get\_filter\_position(self, number: int) -\/> int:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00417}00417     \textcolor{comment}{\#     self.assert\_filterwheel\_number(number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00418}00418     \textcolor{comment}{\#     answer = self.get\_command(b"{}7 \%d F"{} \% number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00419}00419     \textcolor{comment}{\#     return int(answer)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00420}00420 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00421}00421     \textcolor{comment}{\# def set\_filter\_position(self, number: int, pos: int) -\/> None:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00422}00422     \textcolor{comment}{\#     self.assert\_filterwheel\_number(number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00423}00423     \textcolor{comment}{\#     self.move\_command(b"{}7 \%d \%d"{} \% (number, pos))}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00424}00424 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00425}00425 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00426}00426 \textcolor{comment}{\#IMD 20220408}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00427}00427 \textcolor{comment}{\#Not yet implemented filterwheel or shutters as I dont have any on my system}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00428}00428         }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00429}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1ludl_m_c2000}{00429}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1ludl_m_c2000}{ludlMC2000}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_controller}{microscope.abc.Controller}}):}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00430}00430     \textcolor{stringliteral}{"{}"{}"{}Ludl MC 2000 controller.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00431}00431 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00432}00432 \textcolor{stringliteral}{    .. note::}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00433}00433 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00434}00434 \textcolor{stringliteral}{       The Ludl MC5000 can control a stage, filter wheels }\textcolor{keywordflow}{and} shutters.}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00435}00435  }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00436}00436     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00437}00437 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00438}00438 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00439}00439 \textcolor{stringliteral}{    }}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00440}00440 \textcolor{stringliteral}{    }\textcolor{keyword}{def }\_\_init\_\_(}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00441}00441         self, port: str, baudrate: int = 9600, timeout: float = 0.5, **kwargs}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00442}00442     ) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00443}00443         super().\_\_init\_\_(**kwargs)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00444}00444         self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1ludl_m_c2000_afb84511cc984c66597fcee3921057260}{\_conn}} = \mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_controller}{\_LudlController}}(port, baudrate, timeout)}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00445}00445         self.\_devices: typing.Mapping[str, \mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{microscope.abc.Device}}] = \{\}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00446}00446         self.\_devices[\textcolor{stringliteral}{'stage'}]=\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1___ludl_stage}{\_LudlStage}}(self.\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1ludl_m_c2000_afb84511cc984c66597fcee3921057260}{\_conn}})}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00447}00447 \textcolor{comment}{\#        \# Can have up to three filter wheels, numbered 1 to 3.}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00448}00448 \textcolor{comment}{\#        for number in range(1, 4):}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00449}00449 \textcolor{comment}{\#            if self.\_conn.has\_filterwheel(number):}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00450}00450 \textcolor{comment}{\#                key = "{}filter \%d"{} \% number}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00451}00451 \textcolor{comment}{\#                self.\_devices[key] = \_ludlFilterWheel(self.\_conn, number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00452}00452 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00453}00453 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00454}00454 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00455}00455     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00456}\mbox{\hyperlink{classmicroscope_1_1stages_1_1ludl_1_1ludl_m_c2000_ab654864572f7bdd5ac8bab81484e06b4}{00456}}     \textcolor{keyword}{def }devices(self) -\/> typing.Mapping[str, microscope.abc.Device]:}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00457}00457         \textcolor{keywordflow}{return} self.\_devices}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00458}00458 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00459}00459 \textcolor{comment}{\# ludl controller can do filter wheels so leave this code for future adoption}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00460}00460 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00461}00461 \textcolor{comment}{\# class \_ludlFilterWheel(microscope.abc.FilterWheel):}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00462}00462 \textcolor{comment}{\#     def \_\_init\_\_(self, connection: \_ludlConnection, number: int) -\/> None:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00463}00463 \textcolor{comment}{\#         super().\_\_init\_\_(positions=connection.get\_n\_filter\_positions(number))}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00464}00464 \textcolor{comment}{\#         self.\_conn = connection}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00465}00465 \textcolor{comment}{\#         self.\_number = number}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00466}00466 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00467}00467 \textcolor{comment}{\#     def \_do\_get\_position(self) -\/> int:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00468}00468 \textcolor{comment}{\#         return self.\_conn.get\_filter\_position(self.\_number)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00469}00469 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00470}00470 \textcolor{comment}{\#     def \_do\_set\_position(self, position: int) -\/> None:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00471}00471 \textcolor{comment}{\#         self.\_conn.set\_filter\_position(self.\_number, position)}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00472}00472 }
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00473}00473 \textcolor{comment}{\#     def \_do\_shutdown(self) -\/> None:}}
\DoxyCodeLine{\Hypertarget{ludl_8py_source_l00474}00474 \textcolor{comment}{\#         pass}}

\end{DoxyCode}
