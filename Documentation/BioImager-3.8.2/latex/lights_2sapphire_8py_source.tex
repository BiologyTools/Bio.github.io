\hypertarget{lights_2sapphire_8py_source}{}\doxysection{sapphire.\+py}
\label{lights_2sapphire_8py_source}\index{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/lights/sapphire.py@{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/lights/sapphire.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00001}00001 \textcolor{comment}{\#!/usr/bin/env python3}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00003}00003 \textcolor{comment}{\#\# Copyright (C) 2020 David Miguel Susano Pinto <carandraug@gmail.com>}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00004}00004 \textcolor{comment}{\#\# Copyright (C) 2020 Ian Dobbie <ian.dobbie@bioch.ox.ac.uk>}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00005}00005 \textcolor{comment}{\#\# Copyright (C) 2020 Mick Phillips <mick.phillips@gmail.com>}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00006}00006 \textcolor{comment}{\#\# Copyright (C) 2020 Tiago Susano Pinto <tiagosusanopinto@gmail.com>}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00007}00007 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00008}00008 \textcolor{comment}{\#\# This file is part of Microscope.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00009}00009 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00010}00010 \textcolor{comment}{\#\# Microscope is free software: you can redistribute it and/or modify}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00011}00011 \textcolor{comment}{\#\# it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00012}00012 \textcolor{comment}{\#\# the Free Software Foundation, either version 3 of the License, or}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00013}00013 \textcolor{comment}{\#\# (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00014}00014 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00015}00015 \textcolor{comment}{\#\# Microscope is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00016}00016 \textcolor{comment}{\#\# but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00017}00017 \textcolor{comment}{\#\# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00018}00018 \textcolor{comment}{\#\# GNU General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00019}00019 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00020}00020 \textcolor{comment}{\#\# You should have received a copy of the GNU General Public License}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00021}00021 \textcolor{comment}{\#\# along with Microscope.  If not, see <http://www.gnu.org/licenses/>.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00023}00023 \textcolor{keyword}{import} logging}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00025}00025 \textcolor{keyword}{import} serial}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00027}00027 \textcolor{keyword}{import} \mbox{\hyperlink{namespacemicroscope_1_1__utils}{microscope.\_utils}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00028}00028 \textcolor{keyword}{import} \mbox{\hyperlink{namespacemicroscope_1_1abc}{microscope.abc}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00031}00031 \_logger = logging.getLogger(\_\_name\_\_)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00034}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser}{00034}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser}{SapphireLaser}}(}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00035}00035     \mbox{\hyperlink{classmicroscope_1_1__utils_1_1_only_triggers_bulb_on_software_mixin}{microscope.\_utils.OnlyTriggersBulbOnSoftwareMixin}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00036}00036     \mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin}{microscope.abc.SerialDeviceMixin}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00037}00037     \mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source}{microscope.abc.LightSource}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00038}00038 ):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00039}00039     \textcolor{stringliteral}{"{}"{}"{}Coherent Sapphire laser.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00040}00040 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00041}00041 \textcolor{stringliteral}{    The Sapphire }\textcolor{keywordflow}{is} a diode-\/pumped solid-\/state laser \textcolor{keywordflow}{and} only supports}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00042}00042     `TriggerMode.SOFTWARE`.}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00044}00044     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00045}00045 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00046}00046 \textcolor{stringliteral}{    laser\_status = \{}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00047}00047 \textcolor{stringliteral}{        b"{}1"{}}: \textcolor{stringliteral}{"{}Start up"{}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00048}00048         b\textcolor{stringliteral}{"{}2"{}}: \textcolor{stringliteral}{"{}Warmup"{}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00049}00049         b\textcolor{stringliteral}{"{}3"{}}: \textcolor{stringliteral}{"{}Standby"{}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00050}00050         b\textcolor{stringliteral}{"{}4"{}}: \textcolor{stringliteral}{"{}Laser on"{}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00051}00051         b\textcolor{stringliteral}{"{}5"{}}: \textcolor{stringliteral}{"{}Laser ready"{}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00052}00052         b\textcolor{stringliteral}{"{}6"{}}: \textcolor{stringliteral}{"{}Error"{}},}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00053}00053     \}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00055}00055     \textcolor{keyword}{def }\_\_init\_\_(self, com=None, baud=19200, timeout=0.5, **kwargs):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00056}00056         \textcolor{comment}{\# laser controller must run at 19200 baud, 8+1 bits,}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00057}00057         \textcolor{comment}{\# no parity or flow control}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00058}00058         \textcolor{comment}{\# timeout is recomended to be over 0.5}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00059}00059         super().\_\_init\_\_(**kwargs)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00060}00060         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_af286fceb1c5dd5b8702e95f3b15c8f91}{connection}} = serial.Serial(}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00061}00061             port=com,}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00062}00062             baudrate=baud,}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00063}00063             timeout=timeout,}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00064}00064             stopbits=serial.STOPBITS\_ONE,}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00065}00065             bytesize=serial.EIGHTBITS,}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00066}00066             parity=serial.PARITY\_NONE,}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00067}00067         )}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00068}00068         \textcolor{comment}{\# Turning off command prompt}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00069}00069         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}>=0"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00071}00071         \textcolor{comment}{\# The sapphire laser turns on as soon as the key is switched}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00072}00072         \textcolor{comment}{\# on.  So turn radiation off before we start.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00073}00073         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}L=0"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00075}00075         \textcolor{comment}{\# Head ID value is a float point value,}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00076}00076         \textcolor{comment}{\# but only the integer part is significant}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00077}00077         headID = int(float(self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}?hid"{}})))}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00078}00078         \_logger.info(\textcolor{stringliteral}{"{}Sapphire laser serial number: [\%s]"{}}, headID)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00080}00080         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a6af723cb63dbcbb98cc3ad187b8a77e2}{\_max\_power\_mw}} = float(self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}?maxlp"{}}))}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00081}00081         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_ac303b7563542256b4d46198a5f70b101}{\_min\_power}} = float(self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}?minlp"{}})) / self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a6af723cb63dbcbb98cc3ad187b8a77e2}{\_max\_power\_mw}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00082}00082 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00083}00083         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a84ae82a5c5a20f3906ccdd4229a39023}{initialize}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a2d61a8dc271e5c3d23d15a4852e0c14d}{initialize}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00085}00085     \textcolor{keyword}{def }\_write(self, command):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00086}00086         count = super().\_write(command)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00087}00087         \textcolor{comment}{\# This device always writes backs something.  If echo is on,}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00088}00088         \textcolor{comment}{\# it's the whole command, otherwise just an empty line.  Read}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00089}00089         \textcolor{comment}{\# it and throw it away.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00090}00090         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a205a23113fc38758669bcd395f2e04e0}{\_readline}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00091}00091         \textcolor{keywordflow}{return} count}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00093}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{00093}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(self, command):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00094}00094         \textcolor{stringliteral}{"{}"{}"{}Send command and retrieve response."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00095}00095         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a8e3761fe687e216f753641d3bf57400a}{\_write}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afa1608955e3ffe94b179fc76b24cc833}{\_write}}(command)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00096}00096         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a205a23113fc38758669bcd395f2e04e0}{\_readline}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00098}00098     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00099}00099     \textcolor{keyword}{def }clearFault(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00100}00100         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a5804400003be393066c77db7905ff11d}{flush\_buffer}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00101}00101         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ad89d3b36b76fa78d2617794df95502b2}{get\_status}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afff662e56e056fb8266aca127fdcbe3e}{get\_status}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00103}00103     \textcolor{keyword}{def }flush\_buffer(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00104}00104         line = b\textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00105}00105         \textcolor{keywordflow}{while} len(line) > 0:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00106}00106             line = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a205a23113fc38758669bcd395f2e04e0}{\_readline}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00108}00108     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00109}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afff662e56e056fb8266aca127fdcbe3e}{00109}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afff662e56e056fb8266aca127fdcbe3e}{get\_status}}(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00110}00110         result = []}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00112}00112         status\_code = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}?sta"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00113}00113         result.append(}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00114}00114             (}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00115}00115                 \textcolor{stringliteral}{"{}Laser status: "{}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00116}00116                 + self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a60445829d6d46d90cc5ba9bd32ecb8ff}{laser\_status}}.get(status\_code, \textcolor{stringliteral}{"{}Undefined"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00117}00117             )}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00118}00118         )}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00120}00120         \textcolor{keywordflow}{for} cmd, stat \textcolor{keywordflow}{in} [}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00121}00121             (b\textcolor{stringliteral}{"{}?l"{}}, \textcolor{stringliteral}{"{}Ligh Emission on?"{}}),}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00122}00122             (b\textcolor{stringliteral}{"{}?t"{}}, \textcolor{stringliteral}{"{}TEC Servo on?"{}}),}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00123}00123             (b\textcolor{stringliteral}{"{}?k"{}}, \textcolor{stringliteral}{"{}Key Switch on?"{}}),}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00124}00124             (b\textcolor{stringliteral}{"{}?sp"{}}, \textcolor{stringliteral}{"{}Target power:"{}}),}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00125}00125             (b\textcolor{stringliteral}{"{}?p"{}}, \textcolor{stringliteral}{"{}Measured power:"{}}),}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00126}00126             (b\textcolor{stringliteral}{"{}?hh"{}}, \textcolor{stringliteral}{"{}Head operating hours:"{}}),}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00127}00127         ]:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00128}00128             result.append(stat + \textcolor{stringliteral}{"{} "{}} + self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(cmd).decode())}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00130}00130         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a8e3761fe687e216f753641d3bf57400a}{\_write}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afa1608955e3ffe94b179fc76b24cc833}{\_write}}(b\textcolor{stringliteral}{"{}?fl"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00131}00131         faults = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a205a23113fc38758669bcd395f2e04e0}{\_readline}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00132}00132         response = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a205a23113fc38758669bcd395f2e04e0}{\_readline}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00133}00133         \textcolor{keywordflow}{while} response:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00134}00134             faults += b\textcolor{stringliteral}{"{} "{}} + response}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00135}00135             response = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a205a23113fc38758669bcd395f2e04e0}{\_readline}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00137}00137         result.append(faults.decode())}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00138}00138         \textcolor{keywordflow}{return} result}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00140}00140     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00141}00141     \textcolor{keyword}{def }\_do\_shutdown(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00142}00142         \textcolor{comment}{\# Disable laser.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00143}00143         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a8e3761fe687e216f753641d3bf57400a}{\_write}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afa1608955e3ffe94b179fc76b24cc833}{\_write}}(b\textcolor{stringliteral}{"{}l=0"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00144}00144         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a5804400003be393066c77db7905ff11d}{flush\_buffer}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00146}00146     \textcolor{comment}{\#  Initialization to do when cockpit connects.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00147}00147     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00148}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a2d61a8dc271e5c3d23d15a4852e0c14d}{00148}}     \textcolor{keyword}{def }initialize(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00149}00149         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a5804400003be393066c77db7905ff11d}{flush\_buffer}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00151}00151     \textcolor{comment}{\# Turn the laser ON. Return True if we succeeded, False otherwise.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00152}00152     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00153}00153     \textcolor{keyword}{def }\_do\_enable(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00154}00154         \_logger.info(\textcolor{stringliteral}{"{}Turning laser ON."{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00155}00155         \textcolor{comment}{\# Turn on emission.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00156}00156         response = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}l=1"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00157}00157         \_logger.info(\textcolor{stringliteral}{"{}l=1: [\%s]"{}}, response.decode())}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00158}00158 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00159}00159         \textcolor{comment}{\# Enabling laser might take more than 500ms (default timeout)}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00160}00160         prevTimeout = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_af286fceb1c5dd5b8702e95f3b15c8f91}{connection}}.timeout}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00161}00161         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_af286fceb1c5dd5b8702e95f3b15c8f91}{connection}}.timeout = max(1, prevTimeout)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00162}00162         isON = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a368b7bf7f4d13f9176d467fcb0dbf6f3}{get\_is\_on}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a7bd1bf82d28f77d85f9a2b225d48dc75}{get\_is\_on}}()}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00163}00163         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_af286fceb1c5dd5b8702e95f3b15c8f91}{connection}}.timeout = prevTimeout}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00164}00164 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00165}00165         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isON:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00166}00166             \textcolor{comment}{\# Something went wrong.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00167}00167             \_logger.error(\textcolor{stringliteral}{"{}Failed to turn on. Current status:\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00168}00168             \_logger.error(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ad89d3b36b76fa78d2617794df95502b2}{get\_status}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afff662e56e056fb8266aca127fdcbe3e}{get\_status}}())}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00169}00169         \textcolor{keywordflow}{return} isON}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00171}00171     \textcolor{comment}{\# Turn the laser OFF.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00172}00172     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00173}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a158de6a68dcdafd38bfe325935639875}{00173}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a158de6a68dcdafd38bfe325935639875}{disable}}(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00174}00174         \_logger.info(\textcolor{stringliteral}{"{}Turning laser OFF."{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00175}00175         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a8e3761fe687e216f753641d3bf57400a}{\_write}}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_afa1608955e3ffe94b179fc76b24cc833}{\_write}}(b\textcolor{stringliteral}{"{}l=0"{}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00176}00176 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00177}00177     \textcolor{comment}{\# Return True if the laser is currently able to produce light.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00178}00178     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00179}\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a7bd1bf82d28f77d85f9a2b225d48dc75}{00179}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a7bd1bf82d28f77d85f9a2b225d48dc75}{get\_is\_on}}(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00180}00180         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}?l"{}}) == b\textcolor{stringliteral}{"{}1"{}}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00181}00181 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00182}00182     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00183}00183     \textcolor{keyword}{def }\_get\_power\_mw(self):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00184}00184         \textcolor{keywordflow}{return} float(self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}?p"{}}))}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00185}00185 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00186}00186     \textcolor{preprocessor}{@microscope.abc.SerialDeviceMixin.lock\_comms}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00187}00187     \textcolor{keyword}{def }\_set\_power\_mw(self, mW):}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00188}00188         mW\_str = \textcolor{stringliteral}{"{}\%.3f"{}} \% mW}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00189}00189         \_logger.info(\textcolor{stringliteral}{"{}Setting laser power to \%s mW."{}}, mW\_str)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00190}00190         \textcolor{comment}{\# using send instead of \_write, because}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00191}00191         \textcolor{comment}{\# if laser is not on, warning is returned}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00192}00192         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_abcd89b6d1f6db1a78fd70b2e432710ed}{send}}(b\textcolor{stringliteral}{"{}p=\%s"{}} \% mW\_str.encode())}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00193}00193 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00194}00194     \textcolor{keyword}{def }\_do\_set\_power(self, power: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00195}00195         \textcolor{comment}{\# power is already clipped to the [0 1] range but we need to}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00196}00196         \textcolor{comment}{\# clip it again since the min power we actually can do is 0.2}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00197}00197         \textcolor{comment}{\# and we get an error from the laser if we set it to lower.}}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00198}00198         power = max(self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_ac303b7563542256b4d46198a5f70b101}{\_min\_power}}, power)}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00199}00199         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_ad81d37a82ee5cc2482459415a7cf1ac5}{\_set\_power\_mw}}(power * self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a6af723cb63dbcbb98cc3ad187b8a77e2}{\_max\_power\_mw}})}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00201}00201     \textcolor{keyword}{def }\_do\_get\_power(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{lights_2sapphire_8py_source_l00202}00202         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a2ab1aea657af33672eefc1f05255b399}{\_get\_power\_mw}}() / self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1sapphire_1_1_sapphire_laser_a6af723cb63dbcbb98cc3ad187b8a77e2}{\_max\_power\_mw}}}

\end{DoxyCode}
