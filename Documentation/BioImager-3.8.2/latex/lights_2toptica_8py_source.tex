\hypertarget{lights_2toptica_8py_source}{}\doxysection{toptica.\+py}
\label{lights_2toptica_8py_source}\index{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/lights/toptica.py@{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/lights/toptica.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00001}00001 \textcolor{comment}{\#!/usr/bin/env python3}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00003}00003 \textcolor{comment}{\#\# Copyright (C) 2020 David Miguel Susano Pinto <carandraug@gmail.com>}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00004}00004 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00005}00005 \textcolor{comment}{\#\# This file is part of Microscope.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00006}00006 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00007}00007 \textcolor{comment}{\#\# Microscope is free software: you can redistribute it and/or modify}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00008}00008 \textcolor{comment}{\#\# it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00009}00009 \textcolor{comment}{\#\# the Free Software Foundation, either version 3 of the License, or}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00010}00010 \textcolor{comment}{\#\# (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00011}00011 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00012}00012 \textcolor{comment}{\#\# Microscope is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00013}00013 \textcolor{comment}{\#\# but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00014}00014 \textcolor{comment}{\#\# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00015}00015 \textcolor{comment}{\#\# GNU General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00016}00016 \textcolor{comment}{\#\#}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00017}00017 \textcolor{comment}{\#\# You should have received a copy of the GNU General Public License}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00018}00018 \textcolor{comment}{\#\# along with Microscope.  If not, see <http://www.gnu.org/licenses/>.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00020}00020 \textcolor{keyword}{import} logging}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00021}00021 \textcolor{keyword}{import} re}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00022}00022 \textcolor{keyword}{import} typing}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00024}00024 \textcolor{keyword}{import} serial}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00026}00026 \textcolor{keyword}{import} microscope}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00027}00027 \textcolor{keyword}{import} \mbox{\hyperlink{namespacemicroscope_1_1__utils}{microscope.\_utils}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00028}00028 \textcolor{keyword}{import} \mbox{\hyperlink{namespacemicroscope_1_1abc}{microscope.abc}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00031}00031 \_logger = logging.getLogger(\_\_name\_\_)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00034}00034 \textcolor{keyword}{def }\_get\_table\_value(table: bytes, key: bytes) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00035}00035     \textcolor{stringliteral}{"{}"{}"{}Get the value for a key in a table/multiline output.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00036}00036 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00037}00037 \textcolor{stringliteral}{    Some commands }\textcolor{keywordflow}{return} something like a table of key/values.  There}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00038}00038     may be even empty lines on this table.  This searches \textcolor{keywordflow}{for} the}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00039}00039     first line \textcolor{keyword}{with} a specific key (hopefully there\textcolor{stringliteral}{'s only one line}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00040}00040 \textcolor{stringliteral}{    }\textcolor{keyword}{with} such key) \textcolor{keywordflow}{and} returns the associated value.}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00041}00041     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00042}00042 \textcolor{stringliteral}{    }\textcolor{comment}{\# Key might be the first line, hence '(?:\string^|\(\backslash\)r\(\backslash\)n)'}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00043}00043     match = re.search(b\textcolor{stringliteral}{"{}(?:\string^|\(\backslash\)r\(\backslash\)n) *"{}} + key + b\textcolor{stringliteral}{"{}: (.*)\(\backslash\)r\(\backslash\)n"{}}, table)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00044}00044     \textcolor{keywordflow}{if} match \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00045}00045         \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00046}00046             \textcolor{stringliteral}{"{}failed to find key \%s on table: \%s"{}} \% (key, table)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00047}00047         )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00048}00048     \textcolor{keywordflow}{return} match.group(1)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00051}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection}{00051}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection}{\_iBeamConnection}}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00052}00052     \textcolor{stringliteral}{"{}"{}"{}Connection to a specific Toptica iBeam smart laser.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00053}00053 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00054}00054 \textcolor{stringliteral}{    This }\textcolor{keyword}{class }wraps the \mbox{\hyperlink{namespaceserial}{serial}} connection to the device, and provides}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00055}00055     access to some of its commands performing most of the parsing \textcolor{keywordflow}{and}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00056}00056     validation.}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00058}00058     Args:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00059}00059         port: port name (Windows) \textcolor{keywordflow}{or} path to port (everything \textcolor{keywordflow}{else}) to}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00060}00060             connect to.  For example, `/dev/ttyS1`, `COM1`, \textcolor{keywordflow}{or}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00061}00061             `/dev/cuad1`.}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00063}00063     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00064}00064 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00065}00065 \textcolor{stringliteral}{    }\textcolor{keyword}{def }\_\_init\_\_(self, port: str):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00066}00066         \textcolor{comment}{\# From the Toptica iBeam SMART manual:}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00067}00067         \textcolor{comment}{\# Direct connection via COMx with 115200,8,N,1 and serial}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00068}00068         \textcolor{comment}{\# interface handshake "{}none"{}. That means that no hardware}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00069}00069         \textcolor{comment}{\# handshake (DTR, RTS) and no software handshake (XON,XOFF) of}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00070}00070         \textcolor{comment}{\# the underlying operating system is supported.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00071}00071         serial\_conn = serial.Serial(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00072}00072             port=port,}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00073}00073             baudrate=115200,}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00074}00074             timeout=1.0,}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00075}00075             bytesize=serial.EIGHTBITS,}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00076}00076             stopbits=serial.STOPBITS\_ONE,}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00077}00077             parity=serial.PARITY\_NONE,}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00078}00078             xonxoff=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00079}00079             rtscts=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00080}00080             dsrdtr=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00081}00081         )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00082}00082         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}} = \mbox{\hyperlink{classmicroscope_1_1__utils_1_1_shared_serial}{microscope.\_utils.SharedSerial}}(serial\_conn)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00084}00084         \textcolor{comment}{\# We don't know what is the current verbosity state and so we}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00085}00085         \textcolor{comment}{\# don't know yet what we should be reading back.  So blindly}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00086}00086         \textcolor{comment}{\# set to the level we want, flush all output, and then check}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00087}00087         \textcolor{comment}{\# if indeed this is a Toptica iBeam device.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00088}00088         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.lock:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00089}00089             self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.write(b\textcolor{stringliteral}{"{}echo off\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00090}00090             self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.write(b\textcolor{stringliteral}{"{}prompt off\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00091}00091             \textcolor{comment}{\# The talk level we want is 'usual'.  In theory we should}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00092}00092             \textcolor{comment}{\# be able to use 'quiet' which only answers queries but in}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00093}00093             \textcolor{comment}{\# practice 'quiet' does not answer some queries like 'show}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00094}00094             \textcolor{comment}{\# serial'.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00095}00095             self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.write(b\textcolor{stringliteral}{"{}talk usual\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00096}00096             self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.readlines()  \textcolor{comment}{\# discard all pending lines}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00098}00098         \textcolor{comment}{\# Empty command does nothing and returns nothing extra so we}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00099}00099         \textcolor{comment}{\# use it to ensure this at least behaves like a Toptica iBeam.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00100}00100         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00101}00101             self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00102}00102         \textcolor{keywordflow}{except} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}} \textcolor{keyword}{as} e:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00103}00103             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_initialise_error}{microscope.InitialiseError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00104}00104                 \textcolor{stringliteral}{"{}Failed to confirm Toptica iBeam on \%s"{}} \% (port)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00105}00105             ) \textcolor{keyword}{from} e}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00107}00107         answer = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}show serial"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00108}00108         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} answer.startswith(b\textcolor{stringliteral}{"{}SN: "{}}):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00109}00109             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00110}00110                 \textcolor{stringliteral}{"{}Failed to parse serial from \%s"{}} \% answer}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00111}00111             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00112}00112         \_logger.info(\textcolor{stringliteral}{"{}got connection to Toptica iBeam \%s"{}}, answer.decode())}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00113}00113 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00114}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{00114}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(self, command: bytes) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00115}00115         \textcolor{stringliteral}{"{}"{}"{}Run command and return answer after minimal validation.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00116}00116 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00117}00117 \textcolor{stringliteral}{        The output of a command has the format::}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00118}00118 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00119}00119 \textcolor{stringliteral}{            \(\backslash\)r\(\backslash\)nANSWER\(\backslash\)r\(\backslash\)n[OK]\(\backslash\)r\(\backslash\)n}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00120}00120 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00121}00121 \textcolor{stringliteral}{        The returned bytes only include `ANSWER` without its own final}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00122}00122 \textcolor{stringliteral}{        `\(\backslash\)r\(\backslash\)n`.  This means that the }\textcolor{keywordflow}{return} value might be an empty}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00123}00123         array of bytes.}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00124}00124         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00125}00125 \textcolor{stringliteral}{        }\textcolor{comment}{\# We expect to be on 'talk usual' mode without prompt so each}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00126}00126         \textcolor{comment}{\# command will end with [OK] on its own line.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00127}00127         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.lock:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00128}00128             self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.write(command + b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00129}00129             \textcolor{comment}{\# An answer always starts with \(\backslash\)r\(\backslash\)n so there will be one}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00130}00130             \textcolor{comment}{\# before [OK] even if this command is not a query.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00131}00131             answer = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a067e5de46110f554bd22d4187ef8a99b}{\_serial}}.read\_until(b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n[OK]\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00133}00133         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} answer.startswith(b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00134}00134             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00135}00135                 \textcolor{stringliteral}{"{}answer to command \%s does not start with CRLF."{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00136}00136                 \textcolor{stringliteral}{"{} This may be leftovers from a previous command:"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00137}00137                 \textcolor{stringliteral}{"{} \%s"{}} \% (command, answer)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00138}00138             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00139}00139         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} answer.endswith(b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n[OK]\(\backslash\)r\(\backslash\)n"{}}):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00140}00140             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00141}00141                 \textcolor{stringliteral}{"{}Command \%s failed or failed to read answer: \%s"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00142}00142                 \% (command, answer)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00143}00143             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00145}00145         \textcolor{comment}{\# If an error occurred, the answer still ends in [OK].  We}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00146}00146         \textcolor{comment}{\# need to check if the second line (first line is \(\backslash\)r\(\backslash\)n) is an}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00147}00147         \textcolor{comment}{\# error code with the format "{}\%SYS-\/L-\/XXX, error description"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00148}00148         \textcolor{comment}{\# where L is the error level (I for Information, W for}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00149}00149         \textcolor{comment}{\# Warning, E for Error, and F for Fatal), and XXX is the error}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00150}00150         \textcolor{comment}{\# code number.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00151}00151         \textcolor{keywordflow}{if} answer[2:7] == b\textcolor{stringliteral}{"{}\%SYS-\/"{}} \textcolor{keywordflow}{and} answer[7] != ord(b\textcolor{stringliteral}{"{}I"{}}):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00152}00152             \textcolor{comment}{\# Errors of level I (information) should not raise an}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00153}00153             \textcolor{comment}{\# exception since they can be replies to normal commands.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00154}00154             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00155}00155                 \textcolor{stringliteral}{"{}Command \%s failed: \%s"{}} \% (command, answer)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00156}00156             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00158}00158         \textcolor{comment}{\# Exclude the first \(\backslash\)r\(\backslash\)n, the \(\backslash\)r\(\backslash\)n from a possible answer, and}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00159}00159         \textcolor{comment}{\# the final [OK]\(\backslash\)r\(\backslash\)n}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00160}00160         \textcolor{keywordflow}{return} answer[2:-\/8]}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00162}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a4737b82bf1a0a7859fbbb65824e34b2c}{00162}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a4737b82bf1a0a7859fbbb65824e34b2c}{laser\_on}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00163}00163         \textcolor{stringliteral}{"{}"{}"{}Activate LD driver."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00164}00164         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}laser on"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00166}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a58f076d97c5a62722cd50a179ba6c34d}{00166}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a58f076d97c5a62722cd50a179ba6c34d}{laser\_off}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00167}00167         \textcolor{stringliteral}{"{}"{}"{}Deactivate LD driver."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00168}00168         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}laser off"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00169}00169 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00170}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a8cb2fee603f800679afd2cd29f8aac4c}{00170}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a8cb2fee603f800679afd2cd29f8aac4c}{set\_normal\_channel\_power}}(self, power: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00171}00171         \textcolor{stringliteral}{"{}"{}"{}Set power in mW for channel 2 (normal operating level channel).}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00172}00172 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00173}00173 \textcolor{stringliteral}{        We don't have channel number as an argument because we only}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00174}00174 \textcolor{stringliteral}{        want to be setting the power via channel 2 (channel 1 }\textcolor{keywordflow}{is} the}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00175}00175         bias \textcolor{keywordflow}{and} we haven\textcolor{stringliteral}{'t seen a laser with a channel 3 yet).}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00176}00176 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00177}00177 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b"{}channel 2 power \%f"{}} \% power)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00179}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a1ae907c9f13da8ebdbc00aed7c40f122}{00179}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_a1ae907c9f13da8ebdbc00aed7c40f122}{show\_power\_uW}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00180}00180         \textcolor{stringliteral}{"{}"{}"{}Returns actual laser power in µW."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00181}00181         answer = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}show power"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00182}00182         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} answer.startswith(b\textcolor{stringliteral}{"{}PIC  = "{}}) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} answer.endswith(b\textcolor{stringliteral}{"{} uW  "{}}):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00183}00183             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00184}00184                 \textcolor{stringliteral}{"{}failed to parse power from answer: \%s"{}} \% answer}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00185}00185             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00186}00186         \textcolor{keywordflow}{return} float(answer[7:-\/5])}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00187}00187 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00188}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_aef2726bafd493cb8ea6249c2d9cb2eb1}{00188}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_aef2726bafd493cb8ea6249c2d9cb2eb1}{status\_laser}}(self) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00189}00189         \textcolor{stringliteral}{"{}"{}"{}Returns actual status of the LD driver (ON or OFF)."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00190}00190         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}status laser"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00191}00191 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00192}00192     \textcolor{keyword}{def }show\_max\_power(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00193}00193         \textcolor{comment}{\# There should be a cleaner way to get these, right?  We can}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00194}00194         \textcolor{comment}{\# query the current limits (mA) but how do we go from there to}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00195}00195         \textcolor{comment}{\# the power limits (mW)?}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00196}00196         table = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection_ad7451ff2b3be0d9c1f474526d96d935a}{command}}(b\textcolor{stringliteral}{"{}show satellite"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00197}00197         value = \_get\_table\_value(table, key=b\textcolor{stringliteral}{"{}Pmax"{}})}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00198}00198         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} value.endswith(b\textcolor{stringliteral}{"{} mW"{}}):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00199}00199             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00200}00200                 \textcolor{stringliteral}{"{}failed to parse power from \%s"{}} \% value}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00201}00201             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00202}00202         \textcolor{keywordflow}{return} float(value[:-\/3])}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00203}00203 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00204}00204 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00205}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam}{00205}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam}{TopticaiBeam}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00206}00206     \mbox{\hyperlink{classmicroscope_1_1__utils_1_1_only_triggers_bulb_on_software_mixin}{microscope.\_utils.OnlyTriggersBulbOnSoftwareMixin}},}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00207}00207     \mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source}{microscope.abc.LightSource}},}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00208}00208 ):}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00209}00209     \textcolor{stringliteral}{"{}"{}"{}Toptica iBeam smart laser.}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00210}00210 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00211}00211 \textcolor{stringliteral}{    Control of laser power }\textcolor{keywordflow}{is} performed by setting the power level on}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00212}00212     the normal channel (\textcolor{comment}{\#2) only.  The bias channel (\#1) is left}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00213}00213     unmodified \textcolor{keywordflow}{and} so defines the lowest level power.}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00214}00214     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00215}00215 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00216}00216 \textcolor{stringliteral}{    }\textcolor{keyword}{def }\_\_init\_\_(self, port: str, **kwargs) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00217}00217         super().\_\_init\_\_(**kwargs)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00218}00218         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}} = \mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1__i_beam_connection}{\_iBeamConnection}}(port)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00219}00219         \textcolor{comment}{\# The Toptica iBeam has up to five operation modes, named}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00220}00220         \textcolor{comment}{\# "{}channels"{} on the documentation.  Only the first three}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00221}00221         \textcolor{comment}{\# channels have any sort of documentation:}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00222}00222         \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00223}00223         \textcolor{comment}{\#   Ch 1: bias level channel}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00224}00224         \textcolor{comment}{\#   Ch 2: normal operating level channel}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00225}00225         \textcolor{comment}{\#   Ch 3: only used at high-\/power models}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00226}00226         \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00227}00227         \textcolor{comment}{\# We haven't come across a laser with a channel 3 so we are}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00228}00228         \textcolor{comment}{\# ignoring it until then.  So we just leave the bias channel}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00229}00229         \textcolor{comment}{\# (1) alone and control power via the normal channel (2).}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00230}00230         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a39bfdc13e6f1ae701ecc636a0339b7d9}{\_max\_power}} = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}}.show\_max\_power()}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00231}00231 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00232}00232     \textcolor{keyword}{def }\_do\_shutdown(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00233}00233         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00235}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a25f933681399dd9d794cf591c7f370ab}{00235}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a25f933681399dd9d794cf591c7f370ab}{get\_status}}(self) -\/> typing.List[str]:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00236}00236         status: typing.List[str] = []}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00237}00237         \textcolor{keywordflow}{return} status}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00238}00238 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00239}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a6c8e9ce41dfba25d8201d0a566e9ac94}{00239}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a6c8e9ce41dfba25d8201d0a566e9ac94}{enable}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00240}00240         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}}.laser\_on()}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00241}00241 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00242}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_ace72a4800f613b245fa2f35c0683fd21}{00242}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_ace72a4800f613b245fa2f35c0683fd21}{disable}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00243}00243         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}}.laser\_off()}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00244}00244 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00245}\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_aa0222648ea020139d63f50f3255a3171}{00245}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_aa0222648ea020139d63f50f3255a3171}{get\_is\_on}}(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00246}00246         state = self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}}.status\_laser()}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00247}00247         \textcolor{keywordflow}{if} state == b\textcolor{stringliteral}{"{}ON"{}}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00248}00248             \textcolor{keywordflow}{return} \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00249}00249         \textcolor{keywordflow}{elif} state == b\textcolor{stringliteral}{"{}OFF"{}}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00250}00250             \textcolor{keywordflow}{return} \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00251}00251         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00252}00252             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00253}00253                 \textcolor{stringliteral}{"{}Unexpected laser status: \%s"{}} \% state.decode()}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00254}00254             )}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00256}00256     \textcolor{keyword}{def }\_get\_max\_power\_mw(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00257}00257         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a39bfdc13e6f1ae701ecc636a0339b7d9}{\_max\_power}}}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00258}00258 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00259}00259     \textcolor{keyword}{def }\_get\_power\_mw(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00260}00260         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}}.show\_power\_uW() * (10**-\/3)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00261}00261 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00262}00262     \textcolor{keyword}{def }\_set\_power\_mw(self, mw: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00263}00263         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_acefee1a0877b55b815f6502e419e95fd}{\_conn}}.set\_normal\_channel\_power(mw)}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00264}00264 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00265}00265     \textcolor{keyword}{def }\_do\_set\_power(self, power: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00266}00266         self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a59bd0328e5c31dfe83cd21b66450550c}{\_set\_power\_mw}}(power * self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a1d3f9299b606fea1329b5b5a1439a16b}{\_get\_max\_power\_mw}}())}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00267}00267 }
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00268}00268     \textcolor{keyword}{def }\_do\_get\_power(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{lights_2toptica_8py_source_l00269}00269         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_ab2acab57c9a9eec7583078138a580edf}{\_get\_power\_mw}}() / self.\mbox{\hyperlink{classmicroscope_1_1lights_1_1toptica_1_1_topticai_beam_a1d3f9299b606fea1329b5b5a1439a16b}{\_get\_max\_power\_mw}}()}

\end{DoxyCode}
