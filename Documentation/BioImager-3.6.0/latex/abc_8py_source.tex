\hypertarget{abc_8py_source}{}\doxysection{abc.\+py}
\label{abc_8py_source}\index{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/abc.py@{F:/repos/BioImager/BioImager/PythonMicroscope/microscope/abc.py}}
\mbox{\hyperlink{abc_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00001}\mbox{\hyperlink{namespacemicroscope_1_1abc}{00001}} \textcolor{comment}{\#!/usr/bin/env python3}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00021}00021 \textcolor{stringliteral}{"{}"{}"{}Abstract Base Classes for the different device types.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00022}00022 \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00024}00024 \textcolor{keyword}{import} abc}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00025}00025 \textcolor{keyword}{import} functools}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00026}00026 \textcolor{keyword}{import} itertools}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00027}00027 \textcolor{keyword}{import} logging}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00028}00028 \textcolor{keyword}{import} queue}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00029}00029 \textcolor{keyword}{import} threading}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00030}00030 \textcolor{keyword}{import} time}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00031}00031 \textcolor{keyword}{import} typing}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00032}00032 \textcolor{keyword}{from} ast \textcolor{keyword}{import} literal\_eval}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00033}00033 \textcolor{keyword}{from} enum \textcolor{keyword}{import} EnumMeta}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00034}00034 \textcolor{keyword}{from} threading \textcolor{keyword}{import} Thread}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00036}00036 \textcolor{keyword}{import} numpy}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00037}00037 \textcolor{keyword}{import} Pyro4}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00039}00039 \textcolor{keyword}{import} microscope}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00041}00041 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00042}00042 \_logger = logging.getLogger(\_\_name\_\_)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00045}00045 \textcolor{comment}{\# Mapping of setting data types descriptors to allowed-\/value types.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00046}00046 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00047}00047 \textcolor{comment}{\# We use a descriptor for the type instead of the actual type because}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00048}00048 \textcolor{comment}{\# there may not be a unique proper type as for example in enum.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00049}\mbox{\hyperlink{namespacemicroscope_1_1abc_a570fd556039ec97c5e5f43756b2a56bb}{00049}} DTYPES = \{}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00050}00050     \textcolor{stringliteral}{"{}int"{}}: (tuple,),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00051}00051     \textcolor{stringliteral}{"{}float"{}}: (tuple,),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00052}00052     \textcolor{stringliteral}{"{}bool"{}}: (type(\textcolor{keywordtype}{None}),),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00053}00053     \textcolor{stringliteral}{"{}enum"{}}: (list, EnumMeta, dict, tuple),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00054}00054     \textcolor{stringliteral}{"{}str"{}}: (int,),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00055}00055     \textcolor{stringliteral}{"{}tuple"{}}: (type(\textcolor{keywordtype}{None}),),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00056}00056 \}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00059}00059 \textcolor{keyword}{def }\_call\_if\_callable(f):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00060}00060     \textcolor{stringliteral}{"{}"{}"{}Call callables, or return value of non-\/callables."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00061}00061     \textcolor{keywordflow}{return} f() \textcolor{keywordflow}{if} callable(f) \textcolor{keywordflow}{else} f}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00064}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting}{00064}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting}{\_Setting}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00065}00065     \textcolor{stringliteral}{"{}"{}"{}Create a setting.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00066}00066 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00067}00067 \textcolor{stringliteral}{    Args:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00068}00068 \textcolor{stringliteral}{        name: the setting's name.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00069}00069 \textcolor{stringliteral}{        dtype: a data type }\textcolor{keyword}{from} `\textcolor{stringliteral}{"{}int"{}}`, `\textcolor{stringliteral}{"{}float"{}}`, `\textcolor{stringliteral}{"{}bool"{}}`,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00070}00070             `\textcolor{stringliteral}{"{}enum"{}}`, \textcolor{keywordflow}{or} `\textcolor{stringliteral}{"{}str"{}}` (see `DTYPES`).}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00071}00071         get\_func: a function to get the current value.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00072}00072         set\_func: a function to set the value.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00073}00073         values: a description of allowed values dependent on dtype, \textcolor{keywordflow}{or}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00074}00074             function that returns a description.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00075}00075         readonly: an optional function to indicate \textcolor{keywordflow}{if} the setting \textcolor{keywordflow}{is}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00076}00076             readonly.  A setting may be readonly temporarily, so this}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00077}00077             function will \textcolor{keywordflow}{return} `\textcolor{keyword}{True}` \textcolor{keywordflow}{or} `\textcolor{keyword}{False}` to indicate its}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00078}00078             current state.  If set to no `\textcolor{keywordtype}{None}` (default), then its}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00079}00079             value will be dependent on the value of `set\_func`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00081}00081     A client needs some way of knowing a setting name \textcolor{keywordflow}{and} data type,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00082}00082     retrieving the current value \textcolor{keywordflow}{and}, \textcolor{keywordflow}{if} settable, a way to retrieve}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00083}00083     allowable values, \textcolor{keywordflow}{and} set the value.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00085}00085     Setters \textcolor{keywordflow}{and} getters accept \textcolor{keywordflow}{or} \textcolor{keywordflow}{return}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00087}00087     * the setting value \textcolor{keywordflow}{for} int, float, bool \textcolor{keywordflow}{and} str;}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00088}00088     * the setting index into a list, dict \textcolor{keywordflow}{or} Enum type \textcolor{keywordflow}{for} enum.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00090}00090     .. todo::}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00092}00092         refactor into subclasses to avoid \textcolor{keywordflow}{if} isinstance .. \textcolor{keywordflow}{elif}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00093}00093         .. \textcolor{keywordflow}{else}.  Settings classes should be private: devices should}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00094}00094         use a factory method rather than instantiate settings}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00095}00095         directly; most already use add\_setting \textcolor{keywordflow}{for} this.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00096}00096 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00097}00097     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00098}00098 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00099}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_ab2b6ba445396ab3d0e350dbf4898a007}{00099}} \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_ab2b6ba445396ab3d0e350dbf4898a007}{\_\_init\_\_}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00100}00100         self,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00101}00101         name: str,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00102}00102         dtype: str,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00103}00103         get\_func: typing.Optional[typing.Callable[[], typing.Any]],}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00104}00104         set\_func: typing.Optional[typing.Callable[[typing.Any], \textcolor{keywordtype}{None}]] = \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00105}00105         values: typing.Any = \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00106}00106         readonly: typing.Optional[typing.Callable[[], bool]] = \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00107}00107     ) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00108}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a354652a39947995ab02aeaf646820e45}{00108}}         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a354652a39947995ab02aeaf646820e45}{name}} = name}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00109}00109         \textcolor{keywordflow}{if} dtype \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} DTYPES:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00110}00110             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"{}Unsupported dtype."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00111}00111         \textcolor{keywordflow}{elif} \textcolor{keywordflow}{not} (isinstance(values, DTYPES[dtype]) \textcolor{keywordflow}{or} callable(values)):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00112}00112             \textcolor{keywordflow}{raise} TypeError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00113}00113                 \textcolor{stringliteral}{"{}Invalid values type for \%s '\%s': expected function or \%s"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00114}00114                 \% (dtype, name, DTYPES[dtype])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00115}00115             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00116}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a155191f21fe690c1672464a8db3cff4c}{00116}}         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a155191f21fe690c1672464a8db3cff4c}{dtype}} = dtype}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00117}00117         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_afe494889b7ec795486b6138491b44ca5}{\_get}} = get\_func}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00118}00118         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}} = values}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00119}00119         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aca42aa96fe6628fc35a2808c606a78c0}{\_last\_written}} = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00120}00120         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_afe494889b7ec795486b6138491b44ca5}{\_get}} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00121}00121             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a76f70b9a4c577d65817cab297bd8bc61}{\_set}} = set\_func}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00122}00122         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00123}00123             \textcolor{comment}{\# Cache last written value for write-\/only settings.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00124}00124             \textcolor{keyword}{def }w(value):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00125}00125                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aca42aa96fe6628fc35a2808c606a78c0}{\_last\_written}} = value}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00126}00126                 set\_func(value)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00128}00128             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a76f70b9a4c577d65817cab297bd8bc61}{\_set}} = w}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00130}00130         \textcolor{keywordflow}{if} readonly \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00131}00131             \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a76f70b9a4c577d65817cab297bd8bc61}{\_set}} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00132}00132                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aeb13fa56d2ada2bbd5013b66164395c1}{\_readonly}} = \textcolor{keyword}{lambda}: \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00133}00133             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00134}00134                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aeb13fa56d2ada2bbd5013b66164395c1}{\_readonly}} = \textcolor{keyword}{lambda}: \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00135}00135         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00136}00136             \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a76f70b9a4c577d65817cab297bd8bc61}{\_set}} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00137}00137                 \textcolor{keywordflow}{raise} ValueError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00138}00138                     \textcolor{stringliteral}{"{}`readonly` is not `None` but `set\_func` is `None`"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00139}00139                 )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00140}00140             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00141}00141                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aeb13fa56d2ada2bbd5013b66164395c1}{\_readonly}} = readonly}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00143}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a269150bb26f1e65b544ef99caacd9fef}{00143}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a269150bb26f1e65b544ef99caacd9fef}{describe}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00144}00144         \textcolor{keywordflow}{return} \{}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00145}00145             \textcolor{stringliteral}{"{}type"{}}: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a155191f21fe690c1672464a8db3cff4c}{dtype}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00146}00146             \textcolor{stringliteral}{"{}values"{}}: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aa2cf466fab14b718a1ae470fca1fc6af}{values}}(),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00147}00147             \textcolor{stringliteral}{"{}readonly"{}}: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a8c39fd9909af771934d316dcfb01c801}{readonly}}(),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00148}00148             \textcolor{stringliteral}{"{}cached"{}}: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aca42aa96fe6628fc35a2808c606a78c0}{\_last\_written}} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00149}00149         \}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00151}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a5b85b40907ba9571570d1c9c3f675cba}{00151}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a5b85b40907ba9571570d1c9c3f675cba}{get}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00152}00152         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_afe494889b7ec795486b6138491b44ca5}{\_get}} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00153}00153             value = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_afe494889b7ec795486b6138491b44ca5}{\_get}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00154}00154         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00155}00155             value = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aca42aa96fe6628fc35a2808c606a78c0}{\_last\_written}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00156}00156         \textcolor{keywordflow}{if} isinstance(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}}, EnumMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00157}00157             \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}}(value).value}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00158}00158         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00159}00159             \textcolor{keywordflow}{return} value}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00160}00160 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00161}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a8c39fd9909af771934d316dcfb01c801}{00161}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a8c39fd9909af771934d316dcfb01c801}{readonly}}(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00162}00162         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aeb13fa56d2ada2bbd5013b66164395c1}{\_readonly}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00164}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_abc38af17db5f27b4448cbb305f02c6ed}{00164}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_abc38af17db5f27b4448cbb305f02c6ed}{set}}(self, value) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00165}00165         \textcolor{stringliteral}{"{}"{}"{}Set a setting."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00166}00166         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a76f70b9a4c577d65817cab297bd8bc61}{\_set}} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00167}00167             \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00168}00168         \textcolor{comment}{\# TODO further validation.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00169}00169         \textcolor{keywordflow}{if} isinstance(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}}, EnumMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00170}00170             value = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}}(value)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00171}00171         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a76f70b9a4c577d65817cab297bd8bc61}{\_set}}(value)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00173}\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aa2cf466fab14b718a1ae470fca1fc6af}{00173}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_aa2cf466fab14b718a1ae470fca1fc6af}{values}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00174}00174         \textcolor{keywordflow}{if} isinstance(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}}, EnumMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00175}00175             \textcolor{keywordflow}{return} [(v.value, v.name) \textcolor{keywordflow}{for} v \textcolor{keywordflow}{in} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}}]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00176}00176         values = \_call\_if\_callable(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00177}00177         \textcolor{keywordflow}{if} values \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00178}00178             \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a155191f21fe690c1672464a8db3cff4c}{dtype}} == \textcolor{stringliteral}{"{}enum"{}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00179}00179                 \textcolor{keywordflow}{if} isinstance(values, dict):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00180}00180                     \textcolor{keywordflow}{return} list(values.items())}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00181}00181                 \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00182}00182                     \textcolor{comment}{\# self.\_values is a list or tuple}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00183}00183                     \textcolor{keywordflow}{return} list(enumerate(values))}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00184}00184             \textcolor{keywordflow}{elif} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting_a0f6f4e9c1ffc1e63cbe27927901a789a}{\_values}} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00185}00185                 \textcolor{keywordflow}{return} values}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00186}00186 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00187}00187 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00188}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin}{00188}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin}{FloatingDeviceMixin}}(metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00189}00189     \textcolor{stringliteral}{"{}"{}"{}A mixin for devices that 'float'.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00190}00190 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00191}00191 \textcolor{stringliteral}{    Some SDKs handling multiple devices do }\textcolor{keywordflow}{not} allow \textcolor{keywordflow}{for} explicit}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00192}00192     selection of a specific device.  Instead, when the SDK \textcolor{keywordflow}{is}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00193}00193     initialised it assigns an index to each device.  However, this}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00194}00194     index \textcolor{keywordflow}{is} only unique until the program ends \textcolor{keywordflow}{and} next time the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00195}00195     program runs the device might be assigned a different index.  This}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00196}00196     means that it \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} possible to request a specific device to the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00197}00197     SDK.  Instead, one connects to one of the available devices, then}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00198}00198     initialises it, \textcolor{keywordflow}{and} only then can one check which one we got.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00199}00199 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00200}00200     Floating devices are a problem \textcolor{keywordflow}{in} systems where there are multiple}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00201}00201     devices of the same type but we only want to initialise a subset}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00202}00202     of them.  Make sure that a device really \textcolor{keywordflow}{is} a floating device}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00203}00203     before making use of this \textcolor{keyword}{class}.  Avoid it \textcolor{keywordflow}{if} possible.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00204}00204 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00205}00205     This \textcolor{keyword}{class }is a mixin which enforces the implementation of a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00206}00206     `get\_id` method, which typically returns the device serial number.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00208}00208     Args:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00209}00209         index: the index of the device on a shared library.  This}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00210}00210             argument \textcolor{keywordflow}{is} added by the device\_server program.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00211}00211 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00212}00212     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00213}00213 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00214}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin_abb7d47b00cc0582c5230ec1bd1b085aa}{00214}} \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin_abb7d47b00cc0582c5230ec1bd1b085aa}{\_\_init\_\_}}(self, index: int, **kwargs) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00215}00215         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin_abb7d47b00cc0582c5230ec1bd1b085aa}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00216}00216         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin_a51e6edc5d0a3d0f47b9e640af51cb7ef}{\_index}} = index}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00217}00217 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00218}00218     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00219}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin_a03520e043c352c83536d735f641d285e}{00219}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_floating_device_mixin_a03520e043c352c83536d735f641d285e}{get\_id}}(self) -\/> str:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00220}00220         \textcolor{stringliteral}{"{}"{}"{}Return a unique hardware identifier such as a serial number."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00221}00221         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00222}00222 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00223}00223 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00224}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin}{00224}} \textcolor{keyword}{class }TriggerTargetMixin(metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00225}00225     \textcolor{stringliteral}{"{}"{}"{}Mixin for a device that may be the target of a hardware trigger.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00226}00226 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00227}00227 \textcolor{stringliteral}{    .. todo::}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00228}00228 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00229}00229 \textcolor{stringliteral}{        Need some way to retrieve the supported trigger types }\textcolor{keywordflow}{and}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00230}00230         modes.  This \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} just two lists, one \textcolor{keywordflow}{for} types \textcolor{keywordflow}{and} another}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00231}00231         \textcolor{keywordflow}{for} modes, because some modes can only be used \textcolor{keyword}{with} certain}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00232}00232         types \textcolor{keywordflow}{and} vice-\/versa.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00233}00233 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00234}00234     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00235}00235 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00236}00236 \textcolor{stringliteral}{    }\textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00237}00237     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00238}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_ae7007f4ba2c462e3214ea06abf7398f3}{00238}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_ae7007f4ba2c462e3214ea06abf7398f3}{trigger\_mode}}(self) -\/> microscope.TriggerMode:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00239}00239         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00241}00241     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00242}00242     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00243}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a04e0920d33c9b5c7cedcaba7c41053e3}{00243}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a04e0920d33c9b5c7cedcaba7c41053e3}{trigger\_type}}(self) -\/> microscope.TriggerType:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00244}00244         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00245}00245 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00246}00246     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00247}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a3c74f4111c799b181a6168d35474def0}{00247}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a3c74f4111c799b181a6168d35474def0}{set\_trigger}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00248}00248         self, ttype: microscope.TriggerType, tmode: \mbox{\hyperlink{classmicroscope_1_1_trigger_mode}{microscope.TriggerMode}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00249}00249     ) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00250}00250         \textcolor{stringliteral}{"{}"{}"{}Set device for a specific trigger."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00251}00251         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00252}00252 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00253}00253     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00254}00254     \textcolor{keyword}{def }\_do\_trigger(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00255}00255         \textcolor{stringliteral}{"{}"{}"{}Actual trigger of the device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00256}00256 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00257}00257 \textcolor{stringliteral}{        Classes implementing this interface should implement this}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00258}00258 \textcolor{stringliteral}{        method instead of `trigger`.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00259}00259 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00260}00260 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00261}00261 \textcolor{stringliteral}{        }\textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00263}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a13348ed06ccceb5184881f9fc5330bbb}{00263}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a13348ed06ccceb5184881f9fc5330bbb}{trigger}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00264}00264         \textcolor{stringliteral}{"{}"{}"{}Trigger device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00265}00265 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00266}00266 \textcolor{stringliteral}{        The actual effect }\textcolor{keywordflow}{is} device type dependent.  For example, on a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00267}00267         `Camera` it triggers image acquisition \textcolor{keywordflow}{while} on a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00268}00268         `DeformableMirror` it applies a queued pattern.  See}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00269}00269         documentation \textcolor{keywordflow}{for} the devices implementing this interface \textcolor{keywordflow}{for}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00270}00270         details.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00271}00271 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00272}00272         Raises:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00273}00273             \mbox{\hyperlink{classmicroscope_1_1_incompatible_state_error}{microscope.IncompatibleStateError}}: \textcolor{keywordflow}{if} trigger type \textcolor{keywordflow}{is} \textcolor{keywordflow}{not}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00274}00274                 set to `TriggerType.SOFTWARE`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00275}00275 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00276}00276         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00277}00277 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a04e0920d33c9b5c7cedcaba7c41053e3}{trigger\_type}} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} microscope.TriggerType.SOFTWARE:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00278}00278             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_incompatible_state_error}{microscope.IncompatibleStateError}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00279}00279                 \textcolor{stringliteral}{"{}trigger type is not software"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00280}00280             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00281}00281         \_logger.debug(\textcolor{stringliteral}{"{}trigger by software"{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00282}00282         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a4e8f7872dbdc309164d6fb755307761f}{\_do\_trigger}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00283}00283 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00284}00284 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00285}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{00285}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}(metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00286}00286     \textcolor{stringliteral}{"{}"{}"{}A base device class. All devices should subclass this class."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00288}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a3016ccdfc0aee2a51004de9dd8b7caa9}{00288}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a3016ccdfc0aee2a51004de9dd8b7caa9}{\_\_init\_\_}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00289}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{00289}}         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00290}00290         self.\_settings: typing.Dict[str, \_Setting] = \{\}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00291}00291 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00292}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a2ef1d1788cc5d1a708a0209f2cd5fe11}{00292}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a2ef1d1788cc5d1a708a0209f2cd5fe11}{\_\_del\_\_}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00293}00293         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a7e3ee3d63ee099e1a3b9df649fb28c5c}{shutdown}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00295}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_ad7df11492cd21392cc41021e2304fe4f}{00295}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_ad7df11492cd21392cc41021e2304fe4f}{get\_is\_enabled}}(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00296}00296         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00298}00298     \textcolor{keyword}{def }\_do\_disable(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00299}00299         \textcolor{stringliteral}{"{}"{}"{}Do any device-\/specific work on disable.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00300}00300 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00301}00301 \textcolor{stringliteral}{        Subclasses should override this method rather than modify}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00302}00302 \textcolor{stringliteral}{        `disable`.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00303}00303 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00304}00304 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00305}00305 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00306}00306 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00307}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_add8e7f466e7a28137d6e0ceede74e15e}{00307}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_add8e7f466e7a28137d6e0ceede74e15e}{disable}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00308}00308         \textcolor{stringliteral}{"{}"{}"{}Disable the device for a short period for inactivity."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00309}00309         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a21b0cd26b1a1ab19103ea9f22e0d5254}{\_do\_disable}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00310}00310         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00311}00311 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00312}00312     \textcolor{keyword}{def }\_do\_enable(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00313}00313         \textcolor{stringliteral}{"{}"{}"{}Do any device specific work on enable.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00314}00314 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00315}00315 \textcolor{stringliteral}{        Subclasses should override this method, rather than modify}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00316}00316 \textcolor{stringliteral}{        `enable`.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00317}00317 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00318}00318 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00319}00319 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00321}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_ac7759ad4eb304422f07cfee215a73961}{00321}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_ac7759ad4eb304422f07cfee215a73961}{enable}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00322}00322         \textcolor{stringliteral}{"{}"{}"{}Enable the device."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00323}00323         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00324}00324             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}} = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a5ab587adac09d57797a205e4f4f48313}{\_do\_enable}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00325}00325         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} err:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00326}00326             \_logger.debug(\textcolor{stringliteral}{"{}Error in \_do\_enable:"{}}, exc\_info=err)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00327}00327 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00328}00328     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00329}00329     \textcolor{keyword}{def }\_do\_shutdown(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00330}00330         \textcolor{stringliteral}{"{}"{}"{}Private method -\/ actual shutdown of the device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00331}00331 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00332}00332 \textcolor{stringliteral}{        Users should be calling :meth:`shutdown` }\textcolor{keywordflow}{and} \textcolor{keywordflow}{not} this method.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00333}00333         Concrete implementations should implement this method instead}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00334}00334         of `shutdown`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00335}00335 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00336}00336         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00337}00337 \textcolor{stringliteral}{        }\textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00338}00338 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00339}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a84ae82a5c5a20f3906ccdd4229a39023}{00339}}     \textcolor{keyword}{def }initialize(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00340}00340         \textcolor{stringliteral}{"{}"{}"{}Initialize the device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00341}00341 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00342}00342 \textcolor{stringliteral}{        If devices have this method (}\textcolor{keywordflow}{not} required, \textcolor{keywordflow}{and} many don\textcolor{stringliteral}{'t),}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00343}00343 \textcolor{stringliteral}{        then they should call it }\textcolor{keyword}{as} part of the initialisation, i.e.,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00344}00344         they should call it on their `\_\_init\_\_` method.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00345}00345 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00346}00346         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00347}00347 \textcolor{stringliteral}{        }\textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00348}00348 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00349}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a7e3ee3d63ee099e1a3b9df649fb28c5c}{00349}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a7e3ee3d63ee099e1a3b9df649fb28c5c}{shutdown}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00350}00350         \textcolor{stringliteral}{"{}"{}"{}Shutdown the device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00351}00351 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00352}00352 \textcolor{stringliteral}{        Disable }\textcolor{keywordflow}{and} disconnect the device.  This method should be}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00353}00353         called before destructing the device object, to ensure that}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00354}00354         the device \textcolor{keywordflow}{is} actually shutdown.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00355}00355 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00356}00356         After `shutdown`, the device object \textcolor{keywordflow}{is} no longer usable \textcolor{keywordflow}{and}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00357}00357         calling any other method \textcolor{keywordflow}{is} undefined behaviour.  The only}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00358}00358         exception `shutdown` itself which can be called consecutively,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00359}00359         \textcolor{keywordflow}{and} after the first time will have no effect.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00360}00360 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00361}00361         A device object that has been shutdown can\textcolor{stringliteral}{'t be reinitialised.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00362}00362 \textcolor{stringliteral}{        Instead of reusing the object, a new one should be created}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00363}00363 \textcolor{stringliteral}{        instead.  This means that `shutdown` will leave the device }\textcolor{keywordflow}{in}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00364}00364         a state that it can be reconnected.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00366}00366         .. code-\/block:: python}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00368}00368             device = SomeDevice()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00369}00369             device.shutdown()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00370}00370 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00371}00371             \textcolor{comment}{\# Multiple calls to shutdown are OK}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00372}00372             device.shutdown()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00373}00373             device.shutdown()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00374}00374 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00375}00375             \textcolor{comment}{\# After shutdown, everything else is undefined behaviour.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00376}00376             device.enable()  \textcolor{comment}{\# undefined behaviour}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00377}00377             device.get\_setting(\textcolor{stringliteral}{"{}speed"{}})  \textcolor{comment}{\# undefined behaviour}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00378}00378 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00379}00379             \textcolor{comment}{\# To reinitialise the device, construct a new instance.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00380}00380             device = SomeDevice()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00381}00381 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00382}00382 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00383}00383         .. note::}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00384}00384 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00385}00385             While `\_\_del\_\_` calls `shutdown`, one should \textcolor{keywordflow}{not} rely on}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00386}00386             it.  Python does \textcolor{keywordflow}{not} guarante that `\_\_del\_\_` will be}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00387}00387             called when the interpreter exits so \textcolor{keywordflow}{if} `shutdown` \textcolor{keywordflow}{is} \textcolor{keywordflow}{not}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00388}00388             called explicitely, the devices might \textcolor{keywordflow}{not} be shutdown.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00389}00389 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00390}00390         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00391}00391 \textcolor{stringliteral}{        }\textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00392}00392             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_add8e7f466e7a28137d6e0ceede74e15e}{disable}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00393}00393         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} e:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00394}00394             \_logger.warning(\textcolor{stringliteral}{"{}Exception in disable() during shutdown: \%s"{}}, e)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00395}00395         \_logger.info(\textcolor{stringliteral}{"{}Shutting down ... ... ..."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00396}00396         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a5aea26d74af624eab1335b1974bc9579}{\_do\_shutdown}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00397}00397         \_logger.info(\textcolor{stringliteral}{"{}... ... ... ... shut down completed."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00398}00398 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00399}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a0252c8e32f95c4f8c19bedc1d96c1669}{00399}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a0252c8e32f95c4f8c19bedc1d96c1669}{add\_setting}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00400}00400         self,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00401}00401         name,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00402}00402         dtype,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00403}00403         get\_func,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00404}00404         set\_func,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00405}00405         values,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00406}00406         readonly: typing.Optional[typing.Callable[[], bool]] = \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00407}00407     ) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00408}00408         \textcolor{stringliteral}{"{}"{}"{}Add a setting definition.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00409}00409 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00410}00410 \textcolor{stringliteral}{        Args:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00411}00411 \textcolor{stringliteral}{            name: the setting's name.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00412}00412 \textcolor{stringliteral}{            dtype: a data type }\textcolor{keyword}{from} `\textcolor{stringliteral}{"{}int"{}}`, `\textcolor{stringliteral}{"{}float"{}}`, `\textcolor{stringliteral}{"{}bool"{}}`,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00413}00413                 `\textcolor{stringliteral}{"{}enum"{}}`, \textcolor{keywordflow}{or} `\textcolor{stringliteral}{"{}str"{}}` (see `DTYPES`).}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00414}00414             get\_func: a function to get the current value.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00415}00415             set\_func: a function to set the value.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00416}00416             values: a description of allowed values dependent on}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00417}00417                 dtype, \textcolor{keywordflow}{or} function that returns a description.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00418}00418             readonly: an optional function to indicate \textcolor{keywordflow}{if} the setting}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00419}00419                 \textcolor{keywordflow}{is} readonly.  A setting may be readonly temporarily,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00420}00420                 so this function will \textcolor{keywordflow}{return} `\textcolor{keyword}{True}` \textcolor{keywordflow}{or} `\textcolor{keyword}{False}` to}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00421}00421                 indicate its current state.  If set to no `\textcolor{keywordtype}{None}`}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00422}00422                 (default), then its value will be dependent on the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00423}00423                 value of `set\_func`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00424}00424 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00425}00425         A client needs some way of knowing a setting name \textcolor{keywordflow}{and} data}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00426}00426         type, retrieving the current value \textcolor{keywordflow}{and}, \textcolor{keywordflow}{if} settable, a way to}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00427}00427         retrieve allowable values, \textcolor{keywordflow}{and} set the value.  We store this}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00428}00428         info \textcolor{keywordflow}{in} a dictionary.  I considered having a `Setting1 \textcolor{keyword}{class}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00429}00429         \textcolor{keyword}{with} getter, setter, etc., \textcolor{keywordflow}{and} adding `Setting` instances \textcolor{keyword}{as}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00430}00430         device attributes, but Pyro does \textcolor{keywordflow}{not} support dot notation to}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00431}00431         access the functions we need (e.g. `Device.some\_setting.set`),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00432}00432         so I\textcolor{stringliteral}{'d have to write access functions, anyway.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00433}00433 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00434}00434 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00435}00435 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} dtype \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} DTYPES:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00436}00436             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"{}Unsupported dtype."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00437}00437         \textcolor{keywordflow}{elif} \textcolor{keywordflow}{not} (isinstance(values, DTYPES[dtype]) \textcolor{keywordflow}{or} callable(values)):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00438}00438             \textcolor{keywordflow}{raise} TypeError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00439}00439                 \textcolor{stringliteral}{"{}Invalid values type for \%s '\%s': expected function or \%s"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00440}00440                 \% (dtype, name, DTYPES[dtype])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00441}00441             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00442}00442         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00443}00443             self.\_settings[name] = \mbox{\hyperlink{classmicroscope_1_1abc_1_1___setting}{\_Setting}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00444}00444                 name, dtype, get\_func, set\_func, values, readonly}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00445}00445             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00446}00446 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00447}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a440ac6b85c3111e007f95423b17c4a98}{00447}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a440ac6b85c3111e007f95423b17c4a98}{get\_setting}}(self, name: str):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00448}00448         \textcolor{stringliteral}{"{}"{}"{}Return the current value of a setting."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00449}00449         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00450}00450             \textcolor{keywordflow}{return} self.\_settings[name].get()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00451}00451         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} err:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00452}00452             \_logger.error(\textcolor{stringliteral}{"{}in get\_setting(\%s):"{}}, name, exc\_info=err)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00453}00453             \textcolor{keywordflow}{raise}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00454}00454 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00455}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a33a60cd231f8ae2c781a288a63712da0}{00455}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a33a60cd231f8ae2c781a288a63712da0}{get\_all\_settings}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00456}00456         \textcolor{stringliteral}{"{}"{}"{}Return ordered settings as a list of dicts."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00457}00457         \textcolor{comment}{\# Fetching some settings may fail depending on device state.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00458}00458         \textcolor{comment}{\# Report these values as 'None' and continue fetching other settings.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00459}00459         \textcolor{keyword}{def }catch(f):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00460}00460             \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00461}00461                 \textcolor{keywordflow}{return} f()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00462}00462             \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} err:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00463}00463                 \_logger.error(\textcolor{stringliteral}{"{}getting \%s: \%s"{}}, f.\_\_self\_\_.name, err)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00464}00464                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00465}00465 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00466}00466         \textcolor{keywordflow}{return} \{k: catch(v.get) \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} self.\_settings.items()\}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00467}00467 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00468}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_ab2c54086d9210ce21903155b84a7d379}{00468}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_ab2c54086d9210ce21903155b84a7d379}{set\_setting}}(self, name: str, value) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00469}00469         \textcolor{stringliteral}{"{}"{}"{}Set a setting."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00470}00470         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00471}00471             self.\_settings[name].set(value)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00472}00472         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} err:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00473}00473             \_logger.error(\textcolor{stringliteral}{"{}in set\_setting(\%s):"{}}, name, exc\_info=err)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00474}00474             \textcolor{keywordflow}{raise}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00475}00475 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00476}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_afe429f2c599262063f3efb9482b475b8}{00476}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_afe429f2c599262063f3efb9482b475b8}{describe\_setting}}(self, name: str):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00477}00477         \textcolor{stringliteral}{"{}"{}"{}Return ordered setting descriptions as a list of dicts."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00478}00478         \textcolor{keywordflow}{return} self.\_settings[name].describe()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00479}00479 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00480}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a930dd852e501ecb229a6eda52a9fb435}{00480}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a930dd852e501ecb229a6eda52a9fb435}{describe\_settings}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00481}00481         \textcolor{stringliteral}{"{}"{}"{}Return ordered setting descriptions as a list of dicts."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00482}00482         \textcolor{keywordflow}{return} [(k, v.describe()) \textcolor{keywordflow}{for} (k, v) \textcolor{keywordflow}{in} self.\_settings.items()]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00483}00483 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00484}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a9f30a9b6676629c3694b49686238f2a0}{00484}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a9f30a9b6676629c3694b49686238f2a0}{update\_settings}}(self, incoming, init: bool = \textcolor{keyword}{False}):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00485}00485         \textcolor{stringliteral}{"{}"{}"{}Update settings based on dict of settings and values."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00486}00486         \textcolor{keywordflow}{if} init:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00487}00487             \textcolor{comment}{\# Assume nothing about state: set everything.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00488}00488             my\_keys = set(self.\_settings.keys())}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00489}00489             their\_keys = set(incoming.keys())}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00490}00490             update\_keys = my\_keys \& their\_keys}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00491}00491             \textcolor{keywordflow}{if} update\_keys != my\_keys:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00492}00492                 missing = \textcolor{stringliteral}{"{}, "{}}.join([k \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} my\_keys -\/ their\_keys])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00493}00493                 msg = (}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00494}00494                     \textcolor{stringliteral}{"{}update\_settings init=True but missing keys: \%s."{}} \% missing}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00495}00495                 )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00496}00496                 \_logger.debug(msg)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00497}00497                 \textcolor{keywordflow}{raise} Exception(msg)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00498}00498         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00499}00499             \textcolor{comment}{\# Only update changed values.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00500}00500             my\_keys = set(self.\_settings.keys())}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00501}00501             their\_keys = set(incoming.keys())}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00502}00502             update\_keys = set(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00503}00503                 key}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00504}00504                 \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} my\_keys \& their\_keys}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00505}00505                 \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a440ac6b85c3111e007f95423b17c4a98}{get\_setting}}(key) != incoming[key]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00506}00506             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00507}00507         results = \{\}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00508}00508         \textcolor{comment}{\# Update values.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00509}00509         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} update\_keys:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00510}00510             \textcolor{keywordflow}{if} key \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} my\_keys \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} self.\_settings[key].set:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00511}00511                 \textcolor{comment}{\# Setting not recognised or no set function implemented}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00512}00512                 results[key] = NotImplemented}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00513}00513                 update\_keys.remove(key)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00514}00514                 \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00515}00515             \textcolor{keywordflow}{if} self.\_settings[key].readonly():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00516}00516                 \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00517}00517             self.\_settings[key].set(incoming[key])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00518}00518         \textcolor{comment}{\# Read back values in second loop.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00519}00519         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} update\_keys:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00520}00520             results[key] = self.\_settings[key].get()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00521}00521         \textcolor{keywordflow}{return} results}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00522}00522 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00523}00523 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00524}\mbox{\hyperlink{namespacemicroscope_1_1abc_ac7c18d927137f4f242a5eff08e11e759}{00524}} \textcolor{keyword}{def }keep\_acquiring(func):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00525}00525     \textcolor{stringliteral}{"{}"{}"{}Wrapper to preserve acquiring state of data capture devices."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00526}00526 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00527}00527     \textcolor{keyword}{def }wrapper(self, *args, **kwargs):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00528}00528         \textcolor{keywordflow}{if} self.\_acquiring:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00529}00529             self.abort()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00530}00530             result = func(self, *args, **kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00531}00531             self.\_do\_enable()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00532}00532         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00533}00533             result = func(self, *args, **kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00534}00534         \textcolor{keywordflow}{return} result}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00535}00535 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00536}00536     \textcolor{keywordflow}{return} wrapper}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00537}00537 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00538}00538 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00539}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device}{00539}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device}{DataDevice}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}, metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00540}00540     \textcolor{stringliteral}{"{}"{}"{}A data capture device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00541}00541 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00542}00542 \textcolor{stringliteral}{    This }\textcolor{keyword}{class }handles a thread to fetch data from a device and dispatch}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00543}00543     it to a client.  The client \textcolor{keywordflow}{is} set using \mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6c277bf2aa063667909404cb2dba13b5}{set\_client}}(uri) \textcolor{keywordflow}{or} (legacy)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00544}00544     \mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abf9edf0bbc1c90e2ec2acc2932f39b94}{receiveClient}}(uri).}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00545}00545 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00546}00546     Derived classed should implement::}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00547}00547 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00548}00548     * :meth:`abort` (required)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00549}00549     * :meth:`\_fetch\_data` (required)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00550}00550     * :meth:`\_process\_data` (optional)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00551}00551 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00552}00552     Derived classes may override `\_\_init\_\_`, `enable` \textcolor{keywordflow}{and} `disable`,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00553}00553     but must ensure to call this \textcolor{keyword}{class}\textcolor{stringliteral}{'s implementations as indicated}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00554}00554 \textcolor{stringliteral}{    }\textcolor{keywordflow}{in} the docstrings.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00555}00555 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00556}00556     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00557}00557 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00558}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_af306e90265c27e6d643978f5911b54ca}{00558}} \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_af306e90265c27e6d643978f5911b54ca}{\_\_init\_\_}}(self, buffer\_length: int = 0, **kwargs) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00559}00559         \textcolor{stringliteral}{"{}"{}"{}Derived.\_\_init\_\_ must call this at some point."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00560}00560         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_af306e90265c27e6d643978f5911b54ca}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00561}00561         \textcolor{comment}{\# A thread to fetch and dispatch data.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00562}00562         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}} = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00563}00563         \textcolor{comment}{\# A flag to control the \_fetch\_thread.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00564}00564         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aedfd0e9ab973c99cdd4f0a7450f6de1f}{\_fetch\_thread\_run}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00565}00565         \textcolor{comment}{\# A flag to indicate that this class uses a fetch callback.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00566}00566         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a3113b504fa5ba3c20d0d4fa3c9a746fd}{\_using\_callback}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00567}00567         \textcolor{comment}{\# Clients to which we send data.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00568}00568         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}} = []}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00569}00569         \textcolor{comment}{\# A set of live clients to avoid repeated dispatch to disconnected client.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00570}00570         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9d52f2e25b57465af3705a503dcd04d0}{\_liveClients}} = set()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00571}00571         \textcolor{comment}{\# A thread to dispatch data.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00572}00572         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a956fbb609946199e678f019332c4b485}{\_dispatch\_thread}} = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00573}00573         \textcolor{comment}{\# A buffer for data dispatch.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00574}00574         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a620b8ef4592aa347e2e17c73c15e590a}{\_dispatch\_buffer}} = queue.Queue(maxsize=buffer\_length)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00575}00575         \textcolor{comment}{\# A flag to indicate if device is ready to acquire.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00576}00576         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6118863efe8fbacccca3ca374c554426}{\_acquiring}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00577}00577         \textcolor{comment}{\# A condition to signal arrival of a new data and unblock grab\_next\_data}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00578}00578         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9e5277e6b0b99308dc493801313bb080}{\_new\_data\_condition}} = threading.Condition()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00579}00579 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00580}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a79506364a09f1a9c988b054049afc1f1}{00580}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a79506364a09f1a9c988b054049afc1f1}{\_\_del\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00581}00581         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_add8e7f466e7a28137d6e0ceede74e15e}{disable}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a1ee17ca01f5f5b02d6fcbad940e4b584}{disable}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00582}00582         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a79506364a09f1a9c988b054049afc1f1}{\_\_del\_\_}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00583}00583 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00584}00584     \textcolor{comment}{\# Wrap set\_setting to pause and resume acquisition.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00585}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad6ae39983871de695304aefac604706f}{00585}}     set\_setting = keep\_acquiring(Device.set\_setting)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00586}00586 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00587}00587     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00588}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a36952a38857bc6c8eb627b2d8b6b867b}{00588}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a36952a38857bc6c8eb627b2d8b6b867b}{abort}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00589}00589         \textcolor{stringliteral}{"{}"{}"{}Stop acquisition as soon as possible."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00590}00590         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6118863efe8fbacccca3ca374c554426}{\_acquiring}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00591}00591 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00592}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad1a6e54ec4324cdc4bcfcb80a8d99ef8}{00592}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad1a6e54ec4324cdc4bcfcb80a8d99ef8}{enable}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00593}00593         \textcolor{stringliteral}{"{}"{}"{}Enable the data capture device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00594}00594 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00595}00595 \textcolor{stringliteral}{        Ensures that a data handling threads are running.  Implement}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00596}00596 \textcolor{stringliteral}{        device specific code }\textcolor{keywordflow}{in} `\_do\_enable`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00597}00597 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00598}00598         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00599}00599 \textcolor{stringliteral}{        \_logger.debug("{}Enabling ..."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00600}00600         \textcolor{comment}{\# Call device-\/specific code.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00601}00601         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00602}00602             result = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a5ab587adac09d57797a205e4f4f48313}{\_do\_enable}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00603}00603         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} err:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00604}00604             \_logger.debug(\textcolor{stringliteral}{"{}Error in \_do\_enable:"{}}, exc\_info=err)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00605}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aeaadc6353820e217ea6fb4e063e53a53}{00605}}             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aeaadc6353820e217ea6fb4e063e53a53}{enabled}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00606}00606             \textcolor{keywordflow}{raise} err}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00607}00607         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} result:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00608}00608             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aeaadc6353820e217ea6fb4e063e53a53}{enabled}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00609}00609         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00610}00610             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aeaadc6353820e217ea6fb4e063e53a53}{enabled}} = \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00611}00611             \textcolor{comment}{\# Set up data fetching}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00612}00612             \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a3113b504fa5ba3c20d0d4fa3c9a746fd}{\_using\_callback}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00613}00613                 \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00614}00614                     self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aedfd0e9ab973c99cdd4f0a7450f6de1f}{\_fetch\_thread\_run}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00615}00615             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00616}00616                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}} \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}.is\_alive():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00617}00617                     self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}} = Thread(target=self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a06d117c2821b776c8da6844286cf0a77}{\_fetch\_loop}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00618}00618                     self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}.daemon = \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00619}00619                     self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}.start()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00620}00620             \textcolor{keywordflow}{if} (}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00621}00621                 \textcolor{keywordflow}{not} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a956fbb609946199e678f019332c4b485}{\_dispatch\_thread}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00622}00622                 \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a956fbb609946199e678f019332c4b485}{\_dispatch\_thread}}.is\_alive()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00623}00623             ):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00624}00624                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a956fbb609946199e678f019332c4b485}{\_dispatch\_thread}} = Thread(target=self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a4ed94264bca80e1d935f51f53e72d68a}{\_dispatch\_loop}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00625}00625                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a956fbb609946199e678f019332c4b485}{\_dispatch\_thread}}.daemon = \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00626}00626                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a956fbb609946199e678f019332c4b485}{\_dispatch\_thread}}.start()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00627}00627             \_logger.debug(\textcolor{stringliteral}{"{}... enabled."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00628}00628 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00629}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a1ee17ca01f5f5b02d6fcbad940e4b584}{00629}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a1ee17ca01f5f5b02d6fcbad940e4b584}{disable}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00630}00630         \textcolor{stringliteral}{"{}"{}"{}Disable the data capture device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00631}00631 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00632}00632 \textcolor{stringliteral}{        Implement device-\/specific code }\textcolor{keywordflow}{in} `\_do\_disable`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00633}00633 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00634}00634         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00635}00635 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aeaadc6353820e217ea6fb4e063e53a53}{enabled}} = }\textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00636}00636         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00637}00637             \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}.is\_alive():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00638}00638                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aedfd0e9ab973c99cdd4f0a7450f6de1f}{\_fetch\_thread\_run}} = \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00639}00639                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a8b8f13117e43bec684c76e0374717b2e}{\_fetch\_thread}}.join()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00640}00640         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a1ee17ca01f5f5b02d6fcbad940e4b584}{disable}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00641}00641 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00642}00642     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00643}00643     \textcolor{keyword}{def }\_fetch\_data(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00644}00644         \textcolor{stringliteral}{"{}"{}"{}Poll for data and return it, with minimal processing.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00645}00645 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00646}00646 \textcolor{stringliteral}{        If the device uses buffering }\textcolor{keywordflow}{in} software, this function should}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00647}00647         copy the data \textcolor{keyword}{from} the buffer, release \textcolor{keywordflow}{or} recycle the buffer,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00648}00648         then \textcolor{keywordflow}{return} a reference to the copy.  Otherwise, \textcolor{keywordflow}{if} the SDK}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00649}00649         returns a data object that will \textcolor{keywordflow}{not} be written to again, this}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00650}00650         function can just \textcolor{keywordflow}{return} a reference to the object.  If no}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00651}00651         data \textcolor{keywordflow}{is} available, \textcolor{keywordflow}{return} `\textcolor{keywordtype}{None}`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00652}00652 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00653}00653         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00654}00654 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00655}00655 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00656}00656     \textcolor{keyword}{def }\_process\_data(self, data):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00657}00657         \textcolor{stringliteral}{"{}"{}"{}Do any data processing and return data."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00658}00658         \textcolor{keywordflow}{return} data}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00659}00659 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00660}00660     \textcolor{keyword}{def }\_send\_data(self, client, data, timestamp):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00661}00661         \textcolor{stringliteral}{"{}"{}"{}Dispatch data to the client."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00662}00662         \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00663}00663             \textcolor{comment}{\# Cockpit will send a client with receiveData and expects}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00664}00664             \textcolor{comment}{\# two arguments (data and timestamp).  But we really want}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00665}00665             \textcolor{comment}{\# to use Python's Queue and instead of just the timestamp}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00666}00666             \textcolor{comment}{\# we should be sending some proper metadata object.  We}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00667}00667             \textcolor{comment}{\# don't have that proper metadata class yet so just send}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00668}00668             \textcolor{comment}{\# the image data as a numpy ndarray for now.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00669}00669             \textcolor{keywordflow}{if} hasattr(client, \textcolor{stringliteral}{"{}put"{}}):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00670}00670                 client.put(data)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00671}00671             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00672}00672                 client.receiveData(data, timestamp)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00673}00673         \textcolor{keywordflow}{except} (}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00674}00674             Pyro4.errors.ConnectionClosedError,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00675}00675             Pyro4.errors.CommunicationError,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00676}00676         ):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00677}00677             \textcolor{comment}{\# Client not listening}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00678}00678             \_logger.info(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00679}00679                 \textcolor{stringliteral}{"{}Removing \%s from client stack: disconnected."{}}, client.\_pyroUri}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00680}00680             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00681}00681             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}} = list(filter(client.\_\_ne\_\_, self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}}))}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00682}00682             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9d52f2e25b57465af3705a503dcd04d0}{\_liveClients}} = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9d52f2e25b57465af3705a503dcd04d0}{\_liveClients}}.difference([client])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00683}00683 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00684}00684     \textcolor{keyword}{def }\_dispatch\_loop(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00685}00685         \textcolor{stringliteral}{"{}"{}"{}Process data and send results to any client."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00686}00686         \textcolor{keywordflow}{while} \textcolor{keyword}{True}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00687}00687             client, data, timestamp = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a620b8ef4592aa347e2e17c73c15e590a}{\_dispatch\_buffer}}.get(block=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00688}00688             \textcolor{keywordflow}{if} client \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9d52f2e25b57465af3705a503dcd04d0}{\_liveClients}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00689}00689                 \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00690}00690             err = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00691}00691             \textcolor{keywordflow}{if} isinstance(data, Exception):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00692}00692                 standard\_exception = Exception(str(data).encode(\textcolor{stringliteral}{"{}ascii"{}}))}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00693}00693                 \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00694}00694                     self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a72d42052ff322e45f858bb29d06b609e}{\_send\_data}}(client, standard\_exception, timestamp)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00695}00695                 \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} e:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00696}00696                     err = e}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00697}00697             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00698}00698                 \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00699}00699                     self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a72d42052ff322e45f858bb29d06b609e}{\_send\_data}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00700}00700                         client, self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a77de3ec3d90cce901074f48554602ee7}{\_process\_data}}(data), timestamp}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00701}00701                     )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00702}00702                 \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} e:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00703}00703                     err = e}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00704}00704             \textcolor{keywordflow}{if} err:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00705}00705                 \textcolor{comment}{\# Raising an exception will kill the dispatch loop. We need}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00706}00706                 \textcolor{comment}{\# another way to notify the client that there was a problem.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00707}00707                 \_logger.error(\textcolor{stringliteral}{"{}in \_dispatch\_loop:"{}}, exc\_info=err)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00708}00708             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a620b8ef4592aa347e2e17c73c15e590a}{\_dispatch\_buffer}}.task\_done()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00709}00709 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00710}00710     \textcolor{keyword}{def }\_fetch\_loop(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00711}00711         \textcolor{stringliteral}{"{}"{}"{}Poll source for data and put it into dispatch buffer."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00712}00712         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aedfd0e9ab973c99cdd4f0a7450f6de1f}{\_fetch\_thread\_run}} = \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00713}00713 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00714}00714         \textcolor{keywordflow}{while} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aedfd0e9ab973c99cdd4f0a7450f6de1f}{\_fetch\_thread\_run}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00715}00715             \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00716}00716                 data = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ae5362d505cc6f90ef11b62c993706352}{\_fetch\_data}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00717}00717             \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} e:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00718}00718                 \_logger.error(\textcolor{stringliteral}{"{}in \_fetch\_loop:"{}}, exc\_info=e)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00719}00719                 \textcolor{comment}{\# Raising an exception will kill the fetch loop. We need}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00720}00720                 \textcolor{comment}{\# another way to notify the client that there was a problem.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00721}00721                 timestamp = time.time()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00722}00722                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a61a172ca760bf27abec42467ab1049a2}{\_put}}(e, timestamp)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00723}00723                 data = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00724}00724             \textcolor{keywordflow}{if} data \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00725}00725                 \textcolor{comment}{\# TODO Add support for timestamp from hardware.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00726}00726                 timestamp = time.time()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00727}00727                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a61a172ca760bf27abec42467ab1049a2}{\_put}}(data, timestamp)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00728}00728             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00729}00729                 time.sleep(0.001)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00730}00730 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00731}00731     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00732}00732     \textcolor{keyword}{def }\_client(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00733}00733         \textcolor{stringliteral}{"{}"{}"{}A getter for the current client."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00734}00734         \textcolor{keywordflow}{return} (self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}} \textcolor{keywordflow}{or} [\textcolor{keywordtype}{None}])[-\/1]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00735}00735 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00736}00736     \textcolor{preprocessor}{@\_client.setter}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00737}00737     \textcolor{keyword}{def }\_client(self, val):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00738}00738         \textcolor{stringliteral}{"{}"{}"{}Push or pop a client from the \_clientStack."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00739}00739         \textcolor{keywordflow}{if} val \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00740}00740             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}}.pop()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00741}00741         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00742}00742             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}}.append(val)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00743}00743         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9d52f2e25b57465af3705a503dcd04d0}{\_liveClients}} = set(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a38bfa0c39358cc6c7f8a2d69553401ff}{\_clientStack}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00744}00744 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00745}00745     \textcolor{keyword}{def }\_put(self, data, timestamp) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00746}00746         \textcolor{stringliteral}{"{}"{}"{}Put data and timestamp into dispatch buffer with target dispatch client."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00747}00747         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a620b8ef4592aa347e2e17c73c15e590a}{\_dispatch\_buffer}}.put((self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad963ba380cb0cfaca37ee26edcb65bb0}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abbf2653adf29d8f891217789ca526bf7}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a0570b41072a7415560bcfff03628046a}{\_client}}, data, timestamp))}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00748}00748 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00749}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6c277bf2aa063667909404cb2dba13b5}{00749}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6c277bf2aa063667909404cb2dba13b5}{set\_client}}(self, new\_client) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00750}00750         \textcolor{stringliteral}{"{}"{}"{}Set up a connection to our client.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00751}00751 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00752}00752 \textcolor{stringliteral}{        Clients now sit }\textcolor{keywordflow}{in} a stack so that a single device may send}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00753}00753         different data to multiple clients \textcolor{keywordflow}{in} a single experiment.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00754}00754         The usage \textcolor{keywordflow}{is} currently::}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00755}00755 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00756}00756             device.set\_client(client) \textcolor{comment}{\# Add client to top of stack}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00757}00757             \textcolor{comment}{\# do stuff, send triggers, receive data}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00758}00758             device.set\_client(\textcolor{keywordtype}{None})   \textcolor{comment}{\# Pop top client off stack.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00759}00759 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00760}00760         There \textcolor{keywordflow}{is} a risk that some other client calls ``\textcolor{keywordtype}{None}`` before}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00761}00761         the current client \textcolor{keywordflow}{is} finished.  Avoiding this will require}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00762}00762         rework here to identify the caller \textcolor{keywordflow}{and} remove only that caller}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00763}00763         \textcolor{keyword}{from} the client stack.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00764}00764 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00765}00765         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00766}00766 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} new\_client \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00767}00767             \textcolor{keywordflow}{if} isinstance(new\_client, (str, Pyro4.core.URI)):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00768}00768                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad963ba380cb0cfaca37ee26edcb65bb0}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abbf2653adf29d8f891217789ca526bf7}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a0570b41072a7415560bcfff03628046a}{\_client}} = Pyro4.Proxy(new\_client)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00769}00769             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00770}00770                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad963ba380cb0cfaca37ee26edcb65bb0}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abbf2653adf29d8f891217789ca526bf7}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a0570b41072a7415560bcfff03628046a}{\_client}} = new\_client}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00771}00771         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00772}00772             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad963ba380cb0cfaca37ee26edcb65bb0}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abbf2653adf29d8f891217789ca526bf7}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a0570b41072a7415560bcfff03628046a}{\_client}} = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00773}00773         \textcolor{comment}{\# \_client uses a setter. Log the result of assignment.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00774}00774         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad963ba380cb0cfaca37ee26edcb65bb0}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abbf2653adf29d8f891217789ca526bf7}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a0570b41072a7415560bcfff03628046a}{\_client}} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00775}00775             \_logger.info(\textcolor{stringliteral}{"{}Current client is None."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00776}00776         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00777}00777             \_logger.info(\textcolor{stringliteral}{"{}Current client is \%s."{}}, str(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ad963ba380cb0cfaca37ee26edcb65bb0}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abbf2653adf29d8f891217789ca526bf7}{\_client}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a0570b41072a7415560bcfff03628046a}{\_client}}))}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00778}00778 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00779}00779     \textcolor{preprocessor}{@keep\_acquiring}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00780}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a307a47932192c807d0501bb0a30d9a37}{00780}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a307a47932192c807d0501bb0a30d9a37}{update\_settings}}(self, settings, init: bool = \textcolor{keyword}{False}) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00781}00781         \textcolor{stringliteral}{"{}"{}"{}Update settings, toggling acquisition if necessary."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00782}00782         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a307a47932192c807d0501bb0a30d9a37}{update\_settings}}(settings, init)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00783}00783 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00784}00784     \textcolor{comment}{\# noinspection PyPep8Naming}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00785}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abf9edf0bbc1c90e2ec2acc2932f39b94}{00785}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_abf9edf0bbc1c90e2ec2acc2932f39b94}{receiveClient}}(self, client\_uri: str) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00786}00786         \textcolor{stringliteral}{"{}"{}"{}A passthrough for compatibility."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00787}00787         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6c277bf2aa063667909404cb2dba13b5}{set\_client}}(client\_uri)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00788}00788 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00789}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ae22a55bc11c9fc470ad23082cbacc8fc}{00789}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_ae22a55bc11c9fc470ad23082cbacc8fc}{grab\_next\_data}}(self, soft\_trigger: bool = \textcolor{keyword}{True}):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00790}00790         \textcolor{stringliteral}{"{}"{}"{}Returns results from next trigger via a direct call.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00791}00791 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00792}00792 \textcolor{stringliteral}{        Args:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00793}00793 \textcolor{stringliteral}{            soft\_trigger: calls :meth:`trigger` }\textcolor{keywordflow}{if} `\textcolor{keyword}{True}`, waits \textcolor{keywordflow}{for}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00794}00794                 hardware trigger \textcolor{keywordflow}{if} `\textcolor{keyword}{False}`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00795}00795 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00796}00796         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00797}00797 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a640a17ad1c1008f954cd4a1dba9b54fc}{enabled}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_aeaadc6353820e217ea6fb4e063e53a53}{enabled}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00798}00798             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_disabled_device_error}{microscope.DisabledDeviceError}}(\textcolor{stringliteral}{"{}Camera not enabled."{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00799}00799         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9e5277e6b0b99308dc493801313bb080}{\_new\_data\_condition}}.acquire()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00800}00800         \textcolor{comment}{\# Push self onto client stack.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00801}00801         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6c277bf2aa063667909404cb2dba13b5}{set\_client}}(self)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00802}00802         \textcolor{comment}{\# Wait for data from next trigger.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00803}00803         \textcolor{keywordflow}{if} soft\_trigger:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00804}00804             self.trigger()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00805}00805         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9e5277e6b0b99308dc493801313bb080}{\_new\_data\_condition}}.wait()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00806}00806         \textcolor{comment}{\# Pop self from client stack}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00807}00807         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a6c277bf2aa063667909404cb2dba13b5}{set\_client}}(\textcolor{keywordtype}{None})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00808}00808         \textcolor{comment}{\# Return the data.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00809}00809         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a771826ea2ee2214f10a3c7795f5c1664}{\_new\_data}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00810}00810 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00811}00811     \textcolor{comment}{\# noinspection PyPep8Naming}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00812}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a57857954200301186f9810237b74eb2d}{00812}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a57857954200301186f9810237b74eb2d}{receiveData}}(self, data, timestamp) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00813}00813         \textcolor{stringliteral}{"{}"{}"{}Unblocks grab\_next\_frame so it can return."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00814}00814         \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9e5277e6b0b99308dc493801313bb080}{\_new\_data\_condition}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00815}00815             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a771826ea2ee2214f10a3c7795f5c1664}{\_new\_data}} = (data, timestamp)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00816}00816             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device_a9e5277e6b0b99308dc493801313bb080}{\_new\_data\_condition}}.notify()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00817}00817 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00818}00818 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00819}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera}{00819}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera}{Camera}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin}{TriggerTargetMixin}}, \mbox{\hyperlink{classmicroscope_1_1abc_1_1_data_device}{DataDevice}}):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00820}00820     \textcolor{stringliteral}{"{}"{}"{}Adds functionality to :class:`DataDevice` to support cameras.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00821}00821 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00822}00822 \textcolor{stringliteral}{    Defines the interface }\textcolor{keywordflow}{for} cameras.  Applies a transform to}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00823}00823     acquired data \textcolor{keywordflow}{in} the processing step.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00824}00824 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00825}00825     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00826}00826 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00827}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a57ab81f2d1d0bf200a49b5fd84606ee7}{00827}} \textcolor{stringliteral}{    ALLOWED\_TRANSFORMS = [p }\textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} itertools.product(*3 * [[\textcolor{keyword}{False}, \textcolor{keyword}{True}]])]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00828}00828 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00829}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_aa83a5fbd2c9d16bd7af0ad180702b365}{00829}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_aa83a5fbd2c9d16bd7af0ad180702b365}{\_\_init\_\_}}(self, **kwargs) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00830}00830         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_aa83a5fbd2c9d16bd7af0ad180702b365}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00831}00831         \textcolor{comment}{\# A list of readout mode descriptions.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00832}00832         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ab3af789ca09fe82c42211390c676ad77}{\_readout\_modes}} = [\textcolor{stringliteral}{"{}default"{}}]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00833}00833         \textcolor{comment}{\# The index of the current readout mode.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00834}00834         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_adf8e7edcfdfbce5020e2ef378227a719}{\_readout\_mode}} = 0}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00835}00835         \textcolor{comment}{\# Transforms to apply to data (fliplr, flipud, rot90)}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00836}00836         \textcolor{comment}{\# Transform to correct for readout order.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00837}00837         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_acf0d5d31f01c90fe6ac0cce1c3ea1c88}{\_readout\_transform}} = (\textcolor{keyword}{False}, \textcolor{keyword}{False}, \textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00838}00838         \textcolor{comment}{\# Transform supplied by client to correct for system geometry.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00839}00839         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad6da17694f0d572d9b6bf647cccaa409}{\_client\_transform}} = (\textcolor{keyword}{False}, \textcolor{keyword}{False}, \textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00840}00840         \textcolor{comment}{\# Result of combining client and readout transforms}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00841}00841         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}} = (\textcolor{keyword}{False}, \textcolor{keyword}{False}, \textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00842}00842         \textcolor{comment}{\# A transform provided by the client.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00843}00843         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a0252c8e32f95c4f8c19bedc1d96c1669}{add\_setting}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00844}00844             \textcolor{stringliteral}{"{}transform"{}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00845}00845             \textcolor{stringliteral}{"{}enum"{}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00846}00846             \textcolor{keyword}{lambda}: Camera.ALLOWED\_TRANSFORMS.index(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00847}00847             \textcolor{keyword}{lambda} index: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a9661c8304efb2af634ea469aaac9c80f}{set\_transform}}(Camera.ALLOWED\_TRANSFORMS[index]),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00848}00848             Camera.ALLOWED\_TRANSFORMS,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00849}00849         )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00850}00850         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a0252c8e32f95c4f8c19bedc1d96c1669}{add\_setting}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00851}00851             \textcolor{stringliteral}{"{}readout mode"{}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00852}00852             \textcolor{stringliteral}{"{}enum"{}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00853}00853             \textcolor{keyword}{lambda}: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_adf8e7edcfdfbce5020e2ef378227a719}{\_readout\_mode}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00854}00854             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ace2ff70daf5a7c4a8ec53b375e5da73f}{set\_readout\_mode}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00855}00855             \textcolor{keyword}{lambda}: self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ab3af789ca09fe82c42211390c676ad77}{\_readout\_modes}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00856}00856         )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00857}00857         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a0252c8e32f95c4f8c19bedc1d96c1669}{add\_setting}}(\textcolor{stringliteral}{"{}roi"{}}, \textcolor{stringliteral}{"{}tuple"{}}, self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a23985107b0809645061cc5b6570e924b}{get\_roi}}, self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a611b492b2e6de513b0f490ce8467d939}{set\_roi}}, \textcolor{keywordtype}{None})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00858}00858 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00859}00859     \textcolor{keyword}{def }\_process\_data(self, data):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00860}00860         \textcolor{stringliteral}{"{}"{}"{}Apply self.\_transform to data."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00861}00861         flips = (self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}[0], self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}[1])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00862}00862         rot = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}[2]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00863}00863 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00864}00864         \textcolor{comment}{\# Choose appropriate transform based on (flips, rot).}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00865}00865         \textcolor{comment}{\# Do rotation}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00866}00866         data = numpy.rot90(data, rot)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00867}00867         \textcolor{comment}{\# Flip}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00868}00868         data = \{}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00869}00869             (0, 0): \textcolor{keyword}{lambda} d: d,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00870}00870             (0, 1): numpy.flipud,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00871}00871             (1, 0): numpy.fliplr,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00872}00872             (1, 1): \textcolor{keyword}{lambda} d: numpy.fliplr(numpy.flipud(d)),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00873}00873         \}[flips](data)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00874}00874         \textcolor{keywordflow}{return} super().\_process\_data(data)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00875}00875 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00876}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ace2ff70daf5a7c4a8ec53b375e5da73f}{00876}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ace2ff70daf5a7c4a8ec53b375e5da73f}{set\_readout\_mode}}(self, description):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00877}00877         \textcolor{stringliteral}{"{}"{}"{}Set the readout mode and \_readout\_transform."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00878}00878         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00879}00879 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00880}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ac427cb07b847ac1ddd32d0964cba9fa2}{00880}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ac427cb07b847ac1ddd32d0964cba9fa2}{get\_transform}}(self):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00881}00881         \textcolor{stringliteral}{"{}"{}"{}Return the current transform without readout transform."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00882}00882         \textcolor{keywordflow}{return} self.\_client\_transform}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00883}00883 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00884}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a9661c8304efb2af634ea469aaac9c80f}{00884}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a9661c8304efb2af634ea469aaac9c80f}{set\_transform}}(self, transform):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00885}00885         \textcolor{stringliteral}{"{}"{}"{}Combine provided transform with readout transform."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00886}00886         \textcolor{keywordflow}{if} isinstance(transform, str):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00887}00887             transform = literal\_eval(transform)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00888}00888         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad6da17694f0d572d9b6bf647cccaa409}{\_client\_transform}} = transform}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00889}00889         lr, ud, rot = (}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00890}00890             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_acf0d5d31f01c90fe6ac0cce1c3ea1c88}{\_readout\_transform}}[i] \string^ transform[i] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(3)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00891}00891         )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00892}00892         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_acf0d5d31f01c90fe6ac0cce1c3ea1c88}{\_readout\_transform}}[2] \textcolor{keywordflow}{and} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad6da17694f0d572d9b6bf647cccaa409}{\_client\_transform}}[2]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00893}00893             lr = \textcolor{keywordflow}{not} lr}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00894}00894             ud = \textcolor{keywordflow}{not} ud}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00895}00895         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}} = (lr, ud, rot)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00896}00896 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00897}00897     \textcolor{keyword}{def }\_set\_readout\_transform(self, new\_transform):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00898}00898         \textcolor{stringliteral}{"{}"{}"{}Update readout transform and update resultant transform."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00899}00899         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_acf0d5d31f01c90fe6ac0cce1c3ea1c88}{\_readout\_transform}} = [bool(int(t)) \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} new\_transform]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00900}00900         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a9661c8304efb2af634ea469aaac9c80f}{set\_transform}}(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad6da17694f0d572d9b6bf647cccaa409}{\_client\_transform}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00901}00901 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00902}00902     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00903}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a925b8831a01c673565ecb97b4f781800}{00903}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a925b8831a01c673565ecb97b4f781800}{set\_exposure\_time}}(self, value: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00904}00904         \textcolor{stringliteral}{"{}"{}"{}Set the exposure time on the device in seconds."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00905}00905         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00906}00906 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00907}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a16e161a6bd61f3968a072971285eb017}{00907}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a16e161a6bd61f3968a072971285eb017}{get\_exposure\_time}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00908}00908         \textcolor{stringliteral}{"{}"{}"{}Return the current exposure time in seconds."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00909}00909         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00910}00910 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00911}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a2048ad36a754b19e2488b77161a08e63}{00911}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a2048ad36a754b19e2488b77161a08e63}{get\_cycle\_time}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00912}00912         \textcolor{stringliteral}{"{}"{}"{}Return the cycle time in seconds."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00913}00913         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00914}00914 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00915}00915     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00916}00916     \textcolor{keyword}{def }\_get\_sensor\_shape(self) -\/> typing.Tuple[int, int]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00917}00917         \textcolor{stringliteral}{"{}"{}"{}Return a tuple of `(width, height)` indicating shape in pixels."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00918}00918         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00919}00919 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00920}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a60bd2f8bd76859fd35d3ed0c135bf391}{00920}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a60bd2f8bd76859fd35d3ed0c135bf391}{get\_sensor\_shape}}(self) -\/> typing.Tuple[int, int]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00921}00921         \textcolor{stringliteral}{"{}"{}"{}Return a tuple of `(width, height)` corrected for transform."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00922}00922         shape = self.\_get\_sensor\_shape()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00923}00923         \textcolor{keywordflow}{if} self.\_transform[2]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00924}00924             \textcolor{comment}{\# 90 degree rotation}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00925}00925             shape = (shape[1], shape[0])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00926}00926         \textcolor{keywordflow}{return} shape}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00927}00927 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00928}00928     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00929}00929     \textcolor{keyword}{def }\_get\_binning(self) -\/> microscope.Binning:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00930}00930         \textcolor{stringliteral}{"{}"{}"{}Return the current binning."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00931}00931         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00932}00932 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00933}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad28cdab8354d25aa19b81353b6f7a480}{00933}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad28cdab8354d25aa19b81353b6f7a480}{get\_binning}}(self) -\/> microscope.Binning:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00934}00934         \textcolor{stringliteral}{"{}"{}"{}Return the current binning corrected for transform."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00935}00935         binning = self.\_get\_binning()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00936}00936         \textcolor{keywordflow}{if} self.\_transform[2]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00937}00937             \textcolor{comment}{\# 90 degree rotation}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00938}00938             binning = \mbox{\hyperlink{classmicroscope_1_1_binning}{microscope.Binning}}(binning[1], binning[0])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00939}00939         \textcolor{keywordflow}{return} binning}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00940}00940 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00941}00941     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00942}00942     \textcolor{keyword}{def }\_set\_binning(self, binning: microscope.Binning):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00943}00943         \textcolor{stringliteral}{"{}"{}"{}Set binning along both axes.  Return `}\textcolor{keyword}{True}` \textcolor{keywordflow}{if} successful.\textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00944}00944 \textcolor{stringliteral}{        }\textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00945}00945 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00946}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a01c44d08b0f7dcb152a211c98858f6d3}{00946}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a01c44d08b0f7dcb152a211c98858f6d3}{set\_binning}}(self, binning: microscope.Binning) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00947}00947         \textcolor{stringliteral}{"{}"{}"{}Set binning along both axes.  Return `}\textcolor{keyword}{True}` \textcolor{keywordflow}{if} successful.\textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00948}00948 \textcolor{stringliteral}{        h\_bin, v\_bin = binning}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00949}00949 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}[2]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00950}00950             \textcolor{comment}{\# 90 degree rotation}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00951}00951             binning = \mbox{\hyperlink{classmicroscope_1_1_binning}{microscope.Binning}}(v\_bin, h\_bin)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00952}00952         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00953}00953             binning = \mbox{\hyperlink{classmicroscope_1_1_binning}{microscope.Binning}}(h\_bin, v\_bin)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00954}00954         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ac5302ba176a66beeb89b7b447f00a18a}{\_set\_binning}}(binning)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00955}00955 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00956}00956     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00957}00957     \textcolor{keyword}{def }\_get\_roi(self) -\/> microscope.ROI:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00958}00958         \textcolor{stringliteral}{"{}"{}"{}Return the ROI as it is on hardware."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00959}00959         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00960}00960 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00961}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a23985107b0809645061cc5b6570e924b}{00961}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a23985107b0809645061cc5b6570e924b}{get\_roi}}(self) -\/> microscope.ROI:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00962}00962         \textcolor{stringliteral}{"{}"{}"{}Return current ROI."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00963}00963         roi = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a8f8a874db026a19fe2d4e0f2b18661fb}{\_get\_roi}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00964}00964         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}[2]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00965}00965             \textcolor{comment}{\# 90 degree rotation}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00966}00966             roi = \mbox{\hyperlink{classmicroscope_1_1_r_o_i}{microscope.ROI}}(roi[1], roi[0], roi[3], roi[2])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00967}00967         \textcolor{keywordflow}{return} roi}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00968}00968 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00969}00969     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00970}00970     \textcolor{keyword}{def }\_set\_roi(self, roi: microscope.ROI):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00971}00971         \textcolor{stringliteral}{"{}"{}"{}Set the ROI on the hardware.  Return `}\textcolor{keyword}{True}` \textcolor{keywordflow}{if} successful.\textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00972}00972 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00973}00973 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00974}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a611b492b2e6de513b0f490ce8467d939}{00974}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a611b492b2e6de513b0f490ce8467d939}{set\_roi}}(self, roi: microscope.ROI) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00975}00975         \textcolor{stringliteral}{"{}"{}"{}Set the ROI according to the provided rectangle.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00976}00976 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00977}00977 \textcolor{stringliteral}{        Return }\textcolor{keyword}{True} \textcolor{keywordflow}{if} ROI set correctly, \textcolor{keyword}{False} otherwise.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00978}00978         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00979}00979 \textcolor{stringliteral}{        maxw, maxh = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a60bd2f8bd76859fd35d3ed0c135bf391}{get\_sensor\_shape}}()}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00980}00980 \textcolor{stringliteral}{        binning = self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad28cdab8354d25aa19b81353b6f7a480}{get\_binning}}()}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00981}00981 \textcolor{stringliteral}{        left, top, width, height = roi}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00982}00982 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} \textcolor{keywordflow}{not} width:  \textcolor{comment}{\# 0 or None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00983}00983             width = maxw // binning.h}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00984}00984         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} height:  \textcolor{comment}{\# 0 or None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00985}00985             height = maxh // binning.v}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00986}00986         \textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_ad640e5a4d03cdb6e89e15b64b5560f41}{\_transform}}[2]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00987}00987             roi = \mbox{\hyperlink{classmicroscope_1_1_r_o_i}{microscope.ROI}}(left, top, height, width)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00988}00988         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00989}00989             roi = \mbox{\hyperlink{classmicroscope_1_1_r_o_i}{microscope.ROI}}(left, top, width, height)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00990}00990         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_camera_a248e7c40b0047921f3ad00f845500a56}{\_set\_roi}}(roi)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00991}00991 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00992}00992 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00993}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin}{00993}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin}{SerialDeviceMixin}}(metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00994}00994     \textcolor{stringliteral}{"{}"{}"{}Mixin for devices that are controlled via serial.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00995}00995 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00996}00996 \textcolor{stringliteral}{    DEPRECATED: turns out that this was a bad idea.  A device that has}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00997}00997 \textcolor{stringliteral}{      a serial connection }\textcolor{keywordflow}{is} \textcolor{keywordflow}{not} a serial connection.  The \textcolor{stringliteral}{"{}has a"{}} \textcolor{keywordflow}{and}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00998}00998       the \textcolor{keywordflow}{not} \textcolor{stringliteral}{"{}is a"{}} should have told us that we should have been}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l00999}00999       using composition instead of subclassing, but there you go.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01000}01000 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01001}01001     Currently handles the flushing \textcolor{keywordflow}{and} locking of the comms channel}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01002}01002     until a command has finished, \textcolor{keywordflow}{and} the passthrough to the serial}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01003}01003     channel.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01004}01004 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01005}01005     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01006}01006 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01007}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a223e61b484d5f3da1ce4a53794685ae2}{01007}} \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a223e61b484d5f3da1ce4a53794685ae2}{\_\_init\_\_}}(self, **kwargs):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01008}01008         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a223e61b484d5f3da1ce4a53794685ae2}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01009}01009         \textcolor{comment}{\# TODO: We should probably construct the connection here but}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01010}01010         \textcolor{comment}{\#       the Serial constructor takes a lot of arguments, and}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01011}01011         \textcolor{comment}{\#       it becomes tricky to separate those from arguments to}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01012}01012         \textcolor{comment}{\#       the constructor of other parent classes.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01013}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{01013}}         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}} = \textcolor{keywordtype}{None}  \textcolor{comment}{\# serial.Serial (to be constructed by child)}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01014}01014         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a84d5b2607032581467befce339becf7d}{\_comms\_lock}} = threading.RLock()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01015}01015 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01016}01016     \textcolor{keyword}{def }\_readline(self) -\/> bytes:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01017}01017         \textcolor{stringliteral}{"{}"{}"{}Read a line from connection without leading and trailing whitespace."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01018}01018         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}.readline().strip()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01019}01019 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01020}01020     \textcolor{keyword}{def }\_write(self, command: bytes) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01021}01021         \textcolor{stringliteral}{"{}"{}"{}Send a command to the device.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01022}01022 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01023}01023 \textcolor{stringliteral}{        This }\textcolor{keywordflow}{is} \textcolor{keywordflow}{not} a simple passthrough to ``serial.Serial.write``,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01024}01024         it will append ``b\textcolor{stringliteral}{'\(\backslash\)\(\backslash\)r\(\backslash\)\(\backslash\)n'}`` to command.  Override this method}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01025}01025         \textcolor{keywordflow}{if} a device requires a specific format.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01026}01026         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01027}01027 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}.write(command + b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01028}01028 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01029}01029     \textcolor{preprocessor}{@staticmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01030}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a43a79573d3996cb9cf15dadeae83fa69}{01030}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a43a79573d3996cb9cf15dadeae83fa69}{lock\_comms}}(func):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01031}01031         \textcolor{stringliteral}{"{}"{}"{}Decorator to flush input buffer and lock communications.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01032}01032 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01033}01033 \textcolor{stringliteral}{        There have been problems }\textcolor{keyword}{with} the DeepStar lasers returning}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01034}01034         junk characters after the expected response, so it \textcolor{keywordflow}{is}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01035}01035         advisable to flush the input buffer prior to running a command}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01036}01036         \textcolor{keywordflow}{and} subsequent readline.  It also locks the comms channel so}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01037}01037         that a function must finish all its communications before}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01038}01038         another can run.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01039}01039 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01040}01040         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01041}01041 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01042}01042 \textcolor{stringliteral}{        }\textcolor{preprocessor}{@functools.wraps(func)}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01043}01043         \textcolor{keyword}{def }wrapper(self, *args, **kwargs):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01044}01044             \textcolor{keyword}{with} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a84d5b2607032581467befce339becf7d}{\_comms\_lock}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01045}01045                 self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_serial_device_mixin_a9e3ba09d83f3a9e56cae14813c6423ea}{connection}}.flushInput()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01046}01046                 \textcolor{keywordflow}{return} func(self, *args, **kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01047}01047 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01048}01048         \textcolor{keywordflow}{return} wrapper}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01049}01049 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01050}01050 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01051}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror}{01051}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror}{DeformableMirror}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin}{TriggerTargetMixin}}, \mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}, metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01052}01052     \textcolor{stringliteral}{"{}"{}"{}Base class for Deformable Mirrors.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01053}01053 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01054}01054 \textcolor{stringliteral}{    There }\textcolor{keywordflow}{is} no method to reset \textcolor{keywordflow}{or} clear a deformable mirror.  While}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01055}01055     different vendors provide functions to do that, it \textcolor{keywordflow}{is} unclear}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01056}01056     exactly what it does the actuators.  Does it set all actuators}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01057}01057     back to something based on a calibration file?  Does it apply a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01058}01058     voltage of zero to each?  Does it set the values to zero \textcolor{keywordflow}{and} what}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01059}01059     does that mean since different deformable mirrors expect values \textcolor{keywordflow}{in}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01060}01060     a different range?  For the sake of uniformity, it \textcolor{keywordflow}{is} better \textcolor{keywordflow}{for}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01061}01061     python-\/microscope users to \textcolor{keywordflow}{pass} the pattern they want, probably a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01062}01062     pattern that flattens the mirror.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01063}01063 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01064}01064     It \textcolor{keywordflow}{is} also unclear what the use case \textcolor{keywordflow}{for} a reset.  If it just to}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01065}01065     set the mirror to an initial state \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} a specific shape, then}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01066}01066     destroying \textcolor{keywordflow}{and} re-\/constructing the DeformableMirror object}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01067}01067     provides the most obvious solution.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01068}01068 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01069}01069     The private properties `\_patterns` \textcolor{keywordflow}{and} `\_pattern\_idx` are}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01070}01070     initialized to `\textcolor{keywordtype}{None}` to support the queueing of patterns \textcolor{keywordflow}{and}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01071}01071     software triggering.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01072}01072 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01073}01073     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01074}01074 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01075}01075 \textcolor{stringliteral}{    }\textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01076}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a0f2a72649f44490f21a7cf00c922f2f9}{01076}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a0f2a72649f44490f21a7cf00c922f2f9}{\_\_init\_\_}}(self, **kwargs) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01077}01077         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a0f2a72649f44490f21a7cf00c922f2f9}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01078}01078         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aeaf6bb2bf657f9205bf0bfddd07e89cc}{\_patterns}}: typing.Optional[numpy.ndarray] = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01079}01079         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aac345a165451a4a1d13dab42ac1a79f3}{\_pattern\_idx}}: int = -\/1}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01080}01080 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01081}01081     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01082}01082     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01083}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_ab0d31d4c7f3b4eb3c5f44990e59c49ea}{01083}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_ab0d31d4c7f3b4eb3c5f44990e59c49ea}{n\_actuators}}(self) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01084}01084         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01085}01085 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01086}01086     \textcolor{keyword}{def }\_validate\_patterns(self, patterns: numpy.ndarray) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01087}01087         \textcolor{stringliteral}{"{}"{}"{}Validate the shape of a series of patterns.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01088}01088 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01089}01089 \textcolor{stringliteral}{        Only validates the shape of the patterns, }\textcolor{keywordflow}{not} \textcolor{keywordflow}{if} the values}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01090}01090         are actually \textcolor{keywordflow}{in} the [0 1] range.  If some hardware \textcolor{keywordflow}{is} unable}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01091}01091         to handle values outside their defined range (most will simply}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01092}01092         clip them), then it\textcolor{stringliteral}{'s the responsability of the subclass to do}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01093}01093 \textcolor{stringliteral}{        the clipping before sending the values.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01094}01094 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01095}01095 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01096}01096 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} patterns.ndim > 2:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01097}01097             \textcolor{keywordflow}{raise} ValueError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01098}01098                 \textcolor{stringliteral}{"{}PATTERNS has \%d dimensions (must be 1 or 2)"{}} \% patterns.ndim}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01099}01099             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01100}01100         \textcolor{keywordflow}{elif} patterns.shape[-\/1] != self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_ab0d31d4c7f3b4eb3c5f44990e59c49ea}{n\_actuators}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01101}01101             \textcolor{keywordflow}{raise} ValueError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01102}01102                 (}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01103}01103                     \textcolor{stringliteral}{"{}PATTERNS length of second dimension '\%d' differs"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01104}01104                     \textcolor{stringliteral}{"{} from number of actuators '\%d'"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01105}01105                     \% (patterns.shape[-\/1], self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_ab0d31d4c7f3b4eb3c5f44990e59c49ea}{n\_actuators}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01106}01106                 )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01107}01107             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01108}01108 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01109}01109     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01110}01110     \textcolor{keyword}{def }\_do\_apply\_pattern(self, pattern: numpy.ndarray) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01111}01111         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01112}01112 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01113}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aacb167c682dc78cef01fa9bd8119280b}{01113}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aacb167c682dc78cef01fa9bd8119280b}{apply\_pattern}}(self, pattern: numpy.ndarray) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01114}01114         \textcolor{stringliteral}{"{}"{}"{}Apply this pattern.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01115}01115 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01116}01116 \textcolor{stringliteral}{        Raises:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01117}01117 \textcolor{stringliteral}{            \mbox{\hyperlink{classmicroscope_1_1_incompatible_state_error}{microscope.IncompatibleStateError}}: }\textcolor{keywordflow}{if} device trigger type \textcolor{keywordflow}{is}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01118}01118                 \textcolor{keywordflow}{not} set to software.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01119}01119 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01120}01120         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01121}01121 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a04e0920d33c9b5c7cedcaba7c41053e3}{trigger\_type}} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} microscope.TriggerType.SOFTWARE:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01122}01122             \textcolor{comment}{\# An alternative to error is to change the trigger type,}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01123}01123             \textcolor{comment}{\# apply the pattern, then restore the trigger type, but}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01124}01124             \textcolor{comment}{\# that would clear the queue on the device.  It's better}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01125}01125             \textcolor{comment}{\# to have the user specifically do it.  See issue \#61.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01126}01126             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_incompatible_state_error}{microscope.IncompatibleStateError}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01127}01127                 \textcolor{stringliteral}{"{}apply\_pattern requires software trigger type"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01128}01128             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01129}01129         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aa91f1ea3302142e8458b52591ee4bfc9}{\_validate\_patterns}}(pattern)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01130}01130         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_ac38b4fad44e92f07b0baeb98d64fc234}{\_do\_apply\_pattern}}(pattern)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01131}01131 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01132}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aabc55f14c48d6e983aa07f6de760c0da}{01132}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aabc55f14c48d6e983aa07f6de760c0da}{queue\_patterns}}(self, patterns: numpy.ndarray) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01133}01133         \textcolor{stringliteral}{"{}"{}"{}Send values to the mirror.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01134}01134 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01135}01135 \textcolor{stringliteral}{        Args:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01136}01136 \textcolor{stringliteral}{            patterns: An `KxN` elements array of values }\textcolor{keywordflow}{in} the range}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01137}01137                 `[0 1]`, where `N` equals the number of actuators, \textcolor{keywordflow}{and}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01138}01138                 `K` \textcolor{keywordflow}{is} the number of patterns.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01139}01139 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01140}01140         A convenience fallback \textcolor{keywordflow}{is} provided \textcolor{keywordflow}{for} software triggering \textcolor{keywordflow}{is}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01141}01141         provided.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01142}01142 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01143}01143         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01144}01144 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aa91f1ea3302142e8458b52591ee4bfc9}{\_validate\_patterns}}(patterns)}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01145}01145 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aeaf6bb2bf657f9205bf0bfddd07e89cc}{\_patterns}} = patterns}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01146}01146 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aac345a165451a4a1d13dab42ac1a79f3}{\_pattern\_idx}} = -\/1  }\textcolor{comment}{\# none is applied yet}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01147}01147 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01148}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a00ad32bca0d8dade56582b3e0b57f2b3}{01148}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a00ad32bca0d8dade56582b3e0b57f2b3}{next\_pattern}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01149}01149         \textcolor{stringliteral}{"{}"{}"{}Apply the next pattern in the queue.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01150}01150 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01151}01151 \textcolor{stringliteral}{        DEPRECATED: this }\textcolor{keywordflow}{is} the same \textcolor{keyword}{as} calling :meth:`trigger`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01152}01152 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01153}01153         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01154}01154 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin_a13348ed06ccceb5184881f9fc5330bbb}{trigger}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a68184efcbdfff846a949420e88fa5294}{trigger}}()}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01155}01155 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01156}01156 \textcolor{stringliteral}{    }\textcolor{keyword}{def }\_do\_trigger(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01157}01157         \textcolor{stringliteral}{"{}"{}"{}Convenience fallback.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01158}01158 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01159}01159 \textcolor{stringliteral}{        This only provides a convenience fallback }\textcolor{keywordflow}{for} devices that}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01160}01160         don\textcolor{stringliteral}{'t support queuing multiple patterns and software trigger,}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01161}01161 \textcolor{stringliteral}{        i.e., devices that take only one pattern at a time.  This }\textcolor{keywordflow}{is}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01162}01162         \textcolor{keywordflow}{not} the case of most devices.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01163}01163 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01164}01164         Devices that support queuing patterns, should override this}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01165}01165         method.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01166}01166 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01167}01167         .. todo::}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01168}01168 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01169}01169             Instead of a convenience fallback, we should have a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01170}01170             separate mixin \textcolor{keywordflow}{for} this.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01171}01171 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01172}01172         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01173}01173 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aeaf6bb2bf657f9205bf0bfddd07e89cc}{\_patterns}} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01174}01174             \textcolor{keywordflow}{raise} \mbox{\hyperlink{classmicroscope_1_1_device_error}{microscope.DeviceError}}(\textcolor{stringliteral}{"{}no pattern queued to apply"{}})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01175}01175         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aac345a165451a4a1d13dab42ac1a79f3}{\_pattern\_idx}} += 1}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01176}01176         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aacb167c682dc78cef01fa9bd8119280b}{apply\_pattern}}(self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aeaf6bb2bf657f9205bf0bfddd07e89cc}{\_patterns}}[self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_aac345a165451a4a1d13dab42ac1a79f3}{\_pattern\_idx}}, :])}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01177}01177 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01178}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a68184efcbdfff846a949420e88fa5294}{01178}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a68184efcbdfff846a949420e88fa5294}{trigger}}(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01179}01179         \textcolor{stringliteral}{"{}"{}"{}Apply the next pattern in the queue."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01180}01180         \textcolor{comment}{\# This is just a passthrough to the TriggerTargetMixin class}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01181}01181         \textcolor{comment}{\# and only exists for the docstring.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01182}01182         \textcolor{keywordflow}{return} super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_deformable_mirror_a68184efcbdfff846a949420e88fa5294}{trigger}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01183}01183 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01184}01184 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01185}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source}{01185}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source}{LightSource}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_trigger_target_mixin}{TriggerTargetMixin}}, \mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}, metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01186}01186     \textcolor{stringliteral}{"{}"{}"{}Light source such as lasers or LEDs.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01187}01187 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01188}01188 \textcolor{stringliteral}{    Light sources often, possibly always, only support the}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01189}01189 \textcolor{stringliteral}{    `TriggerMode.BULB`.  In this context, the trigger type changes}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01190}01190 \textcolor{stringliteral}{    what happens when `enable` }\textcolor{keywordflow}{is} called.  `TriggerType.SOFTWARE`}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01191}01191     means that `enable` will make the device emit light immediately,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01192}01192     \textcolor{keywordflow}{and} disable will make the device stop emit light.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01193}01193 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01194}01194     `TriggerType.HIGH` \textcolor{keywordflow}{or} `TriggerType.LOW` means that `enable` will}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01195}01195     set \textcolor{keywordflow}{and} unset the laser such that it only emits light \textcolor{keywordflow}{while}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01196}01196     receiving a high \textcolor{keywordflow}{or} low TTL, \textcolor{keywordflow}{or} digital, input signal.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01197}01197 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01198}01198     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01199}01199 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01200}01200 \textcolor{stringliteral}{    }\textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01201}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ae9b6a53598f41b773e97ddcb2c78a0ac}{01201}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ae9b6a53598f41b773e97ddcb2c78a0ac}{\_\_init\_\_}}(self, **kwargs):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01202}01202         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ae9b6a53598f41b773e97ddcb2c78a0ac}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01203}01203         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a90299b0af3d292db9b3d1d339871eab5}{\_set\_point}} = 0.0}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01204}01204 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01205}01205     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01206}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ad89d3b36b76fa78d2617794df95502b2}{01206}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ad89d3b36b76fa78d2617794df95502b2}{get\_status}}(self) -\/> typing.List[str]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01207}01207         \textcolor{stringliteral}{"{}"{}"{}Query and return the light source status."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01208}01208         result = []}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01209}01209         \textcolor{keywordflow}{return} result}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01210}01210 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01211}01211     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01212}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a368b7bf7f4d13f9176d467fcb0dbf6f3}{01212}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a368b7bf7f4d13f9176d467fcb0dbf6f3}{get\_is\_on}}(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01213}01213         \textcolor{stringliteral}{"{}"{}"{}Return True if the light source is currently able to produce light."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01214}01214         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01215}01215 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01216}01216     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01217}01217     \textcolor{keyword}{def }\_do\_get\_power(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01218}01218         \textcolor{stringliteral}{"{}"{}"{}Internal function that actually returns the light source power."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01219}01219         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01220}01220 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01221}01221     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01222}01222     \textcolor{keyword}{def }\_do\_set\_power(self, power: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01223}01223         \textcolor{stringliteral}{"{}"{}"{}Internal function that actually sets the light source power.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01224}01224 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01225}01225 \textcolor{stringliteral}{        This function will be called by the `power` attribute setter}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01226}01226 \textcolor{stringliteral}{        after clipping the argument to the [0, 1] interval.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01227}01227 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01228}01228 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01229}01229 \textcolor{stringliteral}{        }\textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01230}01230 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01231}01231     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01232}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a4b03418f0902cf641b233a89d68758ed}{01232}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a4b03418f0902cf641b233a89d68758ed}{power}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01233}01233         \textcolor{stringliteral}{"{}"{}"{}Light source power in the [0, 1] interval."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01234}01234         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a9d0357d31849e48ab0f9cebec7155d8c}{\_do\_get\_power}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01235}01235 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01236}01236     \textcolor{preprocessor}{@power.setter}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01237}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a1671c8739a5cb2dcff788ea2b0a394bf}{01237}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a4b03418f0902cf641b233a89d68758ed}{power}}(self, power: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01238}01238         \textcolor{stringliteral}{"{}"{}"{}Light source power in the [0, 1] interval.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01239}01239 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01240}01240 \textcolor{stringliteral}{        The power value will be clipped to [0, 1] interval.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01241}01241 \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01242}01242 \textcolor{stringliteral}{        clipped\_power = max(min(power, 1.0), 0.0)}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01243}01243 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_ad19ce63dd2540bf94cc08873f41b5f26}{\_do\_set\_power}}(clipped\_power)}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01244}01244 \textcolor{stringliteral}{        self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a90299b0af3d292db9b3d1d339871eab5}{\_set\_point}} = clipped\_power}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01245}01245 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01246}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a1c6a8db0522882c499e9b19748529c1d}{01246}} \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a1c6a8db0522882c499e9b19748529c1d}{get\_set\_power}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01247}01247         \textcolor{stringliteral}{"{}"{}"{}Return the power set point."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01248}01248         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_light_source_a90299b0af3d292db9b3d1d339871eab5}{\_set\_point}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01249}01249 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01250}01250 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01251}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel}{01251}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel}{FilterWheel}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}, metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01252}01252     \textcolor{stringliteral}{"{}"{}"{}ABC for filter wheels, cube turrets, and filter sliders.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01253}01253 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01254}01254 \textcolor{stringliteral}{    FilterWheel devices are devices that have specific positions to}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01255}01255 \textcolor{stringliteral}{    hold different filters.  Implementations will enable the change to}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01256}01256 \textcolor{stringliteral}{    any of those positions, including positions that may }\textcolor{keywordflow}{not} hold a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01257}01257     filter.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01258}01258 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01259}01259     Args:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01260}01260         positions: total number of filter positions on this device.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01261}01261 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01262}01262     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01263}01263 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01264}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a352dc540b23427231703a8e86e864036}{01264}} \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a352dc540b23427231703a8e86e864036}{\_\_init\_\_}}(self, positions: int, **kwargs) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01265}01265         super().\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a352dc540b23427231703a8e86e864036}{\_\_init\_\_}}(**kwargs)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01266}01266         \textcolor{keywordflow}{if} positions < 1:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01267}01267             \textcolor{keywordflow}{raise} ValueError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01268}01268                 \textcolor{stringliteral}{"{}positions must be a positive number (was \%d)"{}} \% positions}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01269}01269             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01270}01270         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ad01c1b12537b79fd789701199fd2beab}{\_positions}} = positions}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01271}01271         \textcolor{comment}{\# The position as an integer.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01272}01272         \textcolor{comment}{\# Deprecated: clients should call get\_position and set\_position;}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01273}01273         \textcolor{comment}{\# still exposed as a setting until cockpit uses set\_position.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01274}01274         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device_a0252c8e32f95c4f8c19bedc1d96c1669}{add\_setting}}(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01275}01275             \textcolor{stringliteral}{"{}position"{}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01276}01276             \textcolor{stringliteral}{"{}int"{}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01277}01277             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a790fcd4add1b57759e6916b3f785d1bb}{get\_position}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01278}01278             self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a91060f8f02077be898536abd4b912e63}{set\_position}},}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01279}01279             \textcolor{keyword}{lambda}: (0, self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a2e90cae83caf903f6f57863561b9f7a2}{get\_num\_positions}}()),}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01280}01280         )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01281}01281 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01282}01282     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01283}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ae2fe23261c2f229532154c570e1e8011}{01283}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ae2fe23261c2f229532154c570e1e8011}{n\_positions}}(self) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01284}01284         \textcolor{stringliteral}{"{}"{}"{}Number of wheel positions."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01285}01285         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ad01c1b12537b79fd789701199fd2beab}{\_positions}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01286}01286 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01287}01287     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01288}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a9ef5f7efd19fd202a51b1b70b12aeff0}{01288}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a8036d13effbd943a8727a87d7b72cc3d}{position}}(self) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01289}01289         \textcolor{stringliteral}{"{}"{}"{}Number of wheel positions (zero-\/based)."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01290}01290         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_aa686973c4eec7764584c247da7f962ac}{\_do\_get\_position}}()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01291}01291 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01292}01292     \textcolor{preprocessor}{@position.setter}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01293}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_acc0885ae9f24abfde54045f3920783e3}{01293}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a8036d13effbd943a8727a87d7b72cc3d}{position}}(self, new\_position: int) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01294}01294         \textcolor{keywordflow}{if} 0 <= new\_position < self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ae2fe23261c2f229532154c570e1e8011}{n\_positions}}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01295}01295             \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ab2305697a3555895d933dd2f64f6516f}{\_do\_set\_position}}(new\_position)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01296}01296         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01297}01297             \textcolor{keywordflow}{raise} ValueError(}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01298}01298                 \textcolor{stringliteral}{"{}can't move to position \%d, limits are [0 \%d]"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01299}01299                 \% (new\_position, self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ae2fe23261c2f229532154c570e1e8011}{n\_positions}} -\/ 1)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01300}01300             )}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01301}01301 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01302}01302     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01303}01303     \textcolor{keyword}{def }\_do\_get\_position(self) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01304}01304         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01305}01305 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01306}01306     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01307}01307     \textcolor{keyword}{def }\_do\_set\_position(self, position: int) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01308}01308         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01309}01309 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01310}01310     \textcolor{comment}{\# Deprecated and kept for backwards compatibility.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01311}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a2e90cae83caf903f6f57863561b9f7a2}{01311}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a2e90cae83caf903f6f57863561b9f7a2}{get\_num\_positions}}(self) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01312}01312         \textcolor{stringliteral}{"{}"{}"{}Deprecated, use the `n\_positions` property."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01313}01313         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_ae2fe23261c2f229532154c570e1e8011}{n\_positions}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01314}01314 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01315}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a790fcd4add1b57759e6916b3f785d1bb}{01315}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a790fcd4add1b57759e6916b3f785d1bb}{get\_position}}(self) -\/> int:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01316}01316         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a8036d13effbd943a8727a87d7b72cc3d}{position}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a9ef5f7efd19fd202a51b1b70b12aeff0}{position}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_acc0885ae9f24abfde54045f3920783e3}{position}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01317}01317 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01318}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a91060f8f02077be898536abd4b912e63}{01318}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a91060f8f02077be898536abd4b912e63}{set\_position}}(self, position: int) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01319}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a8036d13effbd943a8727a87d7b72cc3d}{01319}}         self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a8036d13effbd943a8727a87d7b72cc3d}{position}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_a9ef5f7efd19fd202a51b1b70b12aeff0}{position}}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_filter_wheel_acc0885ae9f24abfde54045f3920783e3}{position}} = position}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01320}01320 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01321}01321 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01322}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_controller}{01322}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_controller}{Controller}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}, metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01323}01323     \textcolor{stringliteral}{"{}"{}"{}Device that controls multiple devices.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01324}01324 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01325}01325 \textcolor{stringliteral}{    Controller devices usually control multiple stage devices,}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01326}01326 \textcolor{stringliteral}{    typically a XY }\textcolor{keywordflow}{and} Z stage, a filterwheel, \textcolor{keywordflow}{and} a light source.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01327}01327     Controller devices also include multi light source engines.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01328}01328 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01329}01329     Each of the controlled devices requires a name.  The choice of}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01330}01330     name \textcolor{keywordflow}{and} its documentation \textcolor{keywordflow}{is} left to the concrete \textcolor{keyword}{class}.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01331}01331 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01332}01332     Shutting down a controller device must shutdown the controlled}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01333}01333     devices.  Concrete classes should be careful to prevent that the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01334}01334     shutdown of a controlled device does \textcolor{keywordflow}{not} shutdown the controller}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01335}01335     \textcolor{keywordflow}{and} the other controlled devices.  This might require that}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01336}01336     controlled devices do nothing \textcolor{keyword}{as} part of their shutdown.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01337}01337 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01338}01338     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01339}01339 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01340}01340 \textcolor{stringliteral}{    }\textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01341}01341     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01342}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_controller_a514852dc8a72c9cf2f0277660a32c555}{01342}}     \textcolor{keyword}{def }devices(self) -\/> typing.Mapping[str, Device]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01343}01343         \textcolor{stringliteral}{"{}"{}"{}Map of names to the controlled devices."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01344}01344         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01345}01345 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01346}01346     \textcolor{keyword}{def }\_do\_shutdown(self) -\/> None:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01347}01347         \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_controller_a514852dc8a72c9cf2f0277660a32c555}{devices}}.values():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01348}01348             d.shutdown()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01349}01349 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01350}01350 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01351}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis}{01351}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis}{StageAxis}}(metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01352}01352     \textcolor{stringliteral}{"{}"{}"{}A single dimension axis for a :class:`StageDevice`.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01353}01353 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01354}01354 \textcolor{stringliteral}{    A `StageAxis` represents a single axis of a stage }\textcolor{keywordflow}{and} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01355}01355     :\textcolor{keyword}{class}:`Device` instance on itself.  Even stages \textcolor{keyword}{with} a single}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01356}01356     axis, such \textcolor{keyword}{as} Z-\/axis piezos, are implemented \textcolor{keyword}{as} a `StageDevice`}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01357}01357     composed of a single `StageAxis` instance.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01358}01358 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01359}01359     The interface \textcolor{keywordflow}{for} `StageAxis` maps to that of `StageDevice` so}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01360}01360     refer to its documentation.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01361}01361 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01362}01362     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01363}01363 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01364}01364 \textcolor{stringliteral}{    }\textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01365}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a4c2f896778b7c7d9717b48f22f06c95a}{01365}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a4c2f896778b7c7d9717b48f22f06c95a}{move\_by}}(self, delta: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01366}01366         \textcolor{stringliteral}{"{}"{}"{}Move axis by given amount."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01367}01367         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01368}01368 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01369}01369     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01370}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a14b522d41fec9cc65afb5a8297ead8c1}{01370}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a14b522d41fec9cc65afb5a8297ead8c1}{move\_to}}(self, pos: float) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01371}01371         \textcolor{stringliteral}{"{}"{}"{}Move axis to specified position."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01372}01372         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01373}01373 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01374}01374     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01375}01375     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01376}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a9bd5dbb04c2cb24282ff839d82e2acf3}{01376}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a9bd5dbb04c2cb24282ff839d82e2acf3}{position}}(self) -\/> float:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01377}01377         \textcolor{stringliteral}{"{}"{}"{}Current axis position."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01378}01378         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01379}01379 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01380}01380     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01381}01381     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01382}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a538a855a503270a2f367d1ba6e9b0274}{01382}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_axis_a538a855a503270a2f367d1ba6e9b0274}{limits}}(self) -\/> microscope.AxisLimits:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01383}01383         \textcolor{stringliteral}{"{}"{}"{}Upper and lower limits values for position."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01384}01384         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01385}01385 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01386}01386 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01387}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage}{01387}} \textcolor{keyword}{class }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage}{Stage}}(\mbox{\hyperlink{classmicroscope_1_1abc_1_1_device}{Device}}, metaclass=abc.ABCMeta):}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01388}01388     \textcolor{stringliteral}{"{}"{}"{}A stage device, composed of :class:`StageAxis` instances.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01389}01389 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01390}01390 \textcolor{stringliteral}{    A stage device can have any number of axes }\textcolor{keywordflow}{and} dimensions.  For a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01391}01391     single `StageDevice` instance each axis has a name that uniquely}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01392}01392     identifies it.  The names of the individual axes are hardware}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01393}01393     dependent \textcolor{keywordflow}{and} will be part of the concrete \textcolor{keyword}{class }documentation.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01394}01394     They are typically strings such \textcolor{keyword}{as} `\textcolor{stringliteral}{"{}x"{}}` \textcolor{keywordflow}{or} `\textcolor{stringliteral}{"{}y"{}}`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01395}01395 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01396}01396     .. code-\/block:: python}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01397}01397 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01398}01398         stage = SomeStageDevice()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01399}01399         stage.enable()  \textcolor{comment}{\# may trigger a stage move}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01400}01400 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01401}01401         \textcolor{comment}{\# move operations}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01402}01402         stage.move\_to(\{\textcolor{stringliteral}{'x'}: 42.0, \textcolor{stringliteral}{'y'}: -\/5.1\})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01403}01403         stage.move\_by(\{\textcolor{stringliteral}{'x'}: -\/5.3, \textcolor{stringliteral}{'y'}: 14.6\})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01404}01404 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01405}01405         \textcolor{comment}{\# Individual StageAxis can be controlled directly.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01406}01406         x\_axis = stage.axes[\textcolor{stringliteral}{'x'}]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01407}01407         y\_axis = stage.axes[\textcolor{stringliteral}{'y'}]}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01408}01408         x\_axis.move\_to(42.0)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01409}01409         y\_axis.move\_by(-\/5.3)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01410}01410 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01411}01411     Not all stage devices support simultaneous move of multiple axes.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01412}01412     Because of this, there \textcolor{keywordflow}{is} no guarantee that move operations \textcolor{keyword}{with}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01413}01413     multiple axes are done simultaneously.  Refer to the concrete}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01414}01414     \textcolor{keyword}{class }documentation for hardware specific details.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01415}01415 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01416}01416     If a move operation involves multiple axes \textcolor{keywordflow}{and} there \textcolor{keywordflow}{is} no support}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01417}01417     \textcolor{keywordflow}{for} simultaneous move, the order of the moves \textcolor{keywordflow}{is} undefined.  If a}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01418}01418     specific order \textcolor{keywordflow}{is} required, one can either call the move functions}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01419}01419     multiple times \textcolor{keywordflow}{in} the expected order, \textcolor{keywordflow}{or} do so via the individual}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01420}01420     axes, like so:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01421}01421 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01422}01422     .. code-\/block:: python}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01423}01423 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01424}01424         \textcolor{comment}{\# Move the x axis first, then mvoe the y axis:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01425}01425         stage.move\_by(\{\textcolor{stringliteral}{'x'}: 10\})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01426}01426         stage.move\_by(\{\textcolor{stringliteral}{'y'}: 4\})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01427}01427 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01428}01428         \textcolor{comment}{\# The same thing but via the individual axes:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01429}01429         stage.axes[\textcolor{stringliteral}{'x'}].\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a19a92bfdb551a1002c964cefb485ea42}{move\_by}}(10)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01430}01430         stage.axes[\textcolor{stringliteral}{'y'}].\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a19a92bfdb551a1002c964cefb485ea42}{move\_by}}(4)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01431}01431 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01432}01432     Move operations will \textcolor{keywordflow}{not} attempt to move a stage beyond its}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01433}01433     limits.  If a call to the move functions would require the stage}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01434}01434     to move beyond its limits the move operation \textcolor{keywordflow}{is} clipped to the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01435}01435     axes limits.  No exception \textcolor{keywordflow}{is} raised.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01436}01436 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01437}01437     .. code-\/block:: python}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01438}01438 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01439}01439         \textcolor{comment}{\# Moves x axis to the its upper limit:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01440}01440         x\_axis.move\_to(x\_axis.limits.upper)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01441}01441 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01442}01442         \textcolor{comment}{\# The same as above since the move operations are clipped to}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01443}01443         \textcolor{comment}{\# the axes limits automatically.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01444}01444         \textcolor{keyword}{import} math}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01445}01445         x\_axis.move\_to(math.inf)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01446}01446         x\_axis.move\_by(math.inf)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01447}01447 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01448}01448     Some stages need to find a reference position, home, before being}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01449}01449     able to be moved.  If required, this happens automatically during}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01450}01450     :func:`enable` (see also :func:`may\_move\_on\_enable`).}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01451}01451     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01452}01452 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01453}01453 \textcolor{stringliteral}{    }\textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01454}01454     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01455}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a4cf92f2e92dd2da8d928c166bc55b800}{01455}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a4cf92f2e92dd2da8d928c166bc55b800}{axes}}(self) -\/> typing.Mapping[str, StageAxis]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01456}01456         \textcolor{stringliteral}{"{}"{}"{}Map of axis names to the corresponding :class:`StageAxis`.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01457}01457 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01458}01458 \textcolor{stringliteral}{        .. code-\/block:: python}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01459}01459 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01460}01460 \textcolor{stringliteral}{            }\textcolor{keywordflow}{for} name, axis \textcolor{keywordflow}{in} stage.axes.items():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01461}01461                 print(f\textcolor{stringliteral}{'moving axis named \{name\}'})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01462}01462                 axis.move\_by(1)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01463}01463 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01464}01464         If an axis \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} available then it \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} included, i.e.,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01465}01465         given a stage \textcolor{keyword}{with} optional axes the missing axes will *\textcolor{keywordflow}{not}*}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01466}01466         appear on the returned dict \textcolor{keyword}{with} a value of `\textcolor{keywordtype}{None}` \textcolor{keywordflow}{or} some}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01467}01467         other special `StageAxis` instance.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01468}01468         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01469}01469 \textcolor{stringliteral}{        }\textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01470}01470 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01471}01471 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01472}01472     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01473}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a825ead0c6bb83d863e192314833dd8b4}{01473}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a825ead0c6bb83d863e192314833dd8b4}{may\_move\_on\_enable}}(self) -\/> bool:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01474}01474         \textcolor{stringliteral}{"{}"{}"{}Whether calling :func:`enable` is likely to make the stage move.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01475}01475 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01476}01476 \textcolor{stringliteral}{        Most stages need to be driven to their limits at startup to}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01477}01477 \textcolor{stringliteral}{        find a repeatable zero position }\textcolor{keywordflow}{and} sometimes to find their}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01478}01478         limits \textcolor{keyword}{as} well.  This \textcolor{keywordflow}{is} typically called \textcolor{stringliteral}{"{}homing"{}}.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01479}01479 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01480}01480         Stages that need to \textcolor{stringliteral}{"{}home"{}} differ on how often they need it}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01481}01481         but they only do it during :func:`enable`.  They may need to}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01482}01482         move each time `enable` \textcolor{keywordflow}{is} called, the first time after the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01483}01483         `Stage` object has been created, \textcolor{keywordflow}{or} even only the first time}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01484}01484         since the device was powered up.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01485}01485 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01486}01486         Note the \textcolor{stringliteral}{"{}*may*"{}} on \textcolor{stringliteral}{"{}may\_move\_on\_enable"{}}.  This \textcolor{keywordflow}{is} because it}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01487}01487         can be difficult to know \textcolor{keywordflow}{for} certain \textcolor{keywordflow}{if} `enable` will cause}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01488}01488         the stage to home.  Still, knowing that the stage *may* move}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01489}01489         \textcolor{keywordflow}{is} essential \textcolor{keywordflow}{for} safety.  An unexpected movement of the stage,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01490}01490         particularly large movements such \textcolor{keyword}{as} moving to the stage}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01491}01491         limits, can destroy a sample on the stage -\/-\/-\/ \textcolor{keywordflow}{or} even worse,}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01492}01492         it can damage an objective \textcolor{keywordflow}{or} the stage itself.  When \textcolor{keywordflow}{in}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01493}01493         doubt, implementations should \textcolor{keywordflow}{return} `\textcolor{keyword}{True}`.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01494}01494 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01495}01495         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01496}01496 \textcolor{stringliteral}{        }\textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01497}01497 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01498}01498 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01499}01499     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01500}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_abe4a9729a9a5c1541b0159a07b992711}{01500}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_abe4a9729a9a5c1541b0159a07b992711}{position}}(self) -\/> typing.Mapping[str, float]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01501}01501         \textcolor{stringliteral}{"{}"{}"{}Map of axis name to their current position.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01502}01502 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01503}01503 \textcolor{stringliteral}{        .. code-\/block:: python}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01504}01504 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01505}01505 \textcolor{stringliteral}{            }\textcolor{keywordflow}{for} name, position \textcolor{keywordflow}{in} stage.position.items():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01506}01506                 print(f\textcolor{stringliteral}{'\{name\} axis is at position \{position\}'})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01507}01507 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01508}01508         The units of the position \textcolor{keywordflow}{is} the same \textcolor{keyword}{as} the ones being}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01509}01509         currently used \textcolor{keywordflow}{for} the absolute move (:func:`move\_to`)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01510}01510         operations.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01511}01511         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01512}01512 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} \{name: axis.position \textcolor{keywordflow}{for} name, axis \textcolor{keywordflow}{in} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a4cf92f2e92dd2da8d928c166bc55b800}{axes}}.items()\}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01513}01513 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01514}01514     \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01515}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a0dd6bdc7ce3afa46d24bab22c9fe6953}{01515}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a0dd6bdc7ce3afa46d24bab22c9fe6953}{limits}}(self) -\/> typing.Mapping[str, microscope.AxisLimits]:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01516}01516         \textcolor{stringliteral}{"{}"{}"{}Map of axis name to its upper and lower limits.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01517}01517 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01518}01518 \textcolor{stringliteral}{        .. code-\/block:: python}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01519}01519 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01520}01520 \textcolor{stringliteral}{            }\textcolor{keywordflow}{for} name, limits \textcolor{keywordflow}{in} stage.limits.items():}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01521}01521                 print(f\textcolor{stringliteral}{'\{name\} axis lower limit is \{limits.lower\}'})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01522}01522                 print(f\textcolor{stringliteral}{'\{name\} axis upper limit is \{limits.upper\}'})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01523}01523 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01524}01524         These are the limits currently imposed by the device \textcolor{keywordflow}{or}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01525}01525         underlying software \textcolor{keywordflow}{and} may change over the time of the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01526}01526         `StageDevice` object.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01527}01527 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01528}01528         The units of the limits \textcolor{keywordflow}{is} the same \textcolor{keyword}{as} the ones being}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01529}01529         currently used \textcolor{keywordflow}{for} the move operations.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01530}01530 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01531}01531         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01532}01532 \textcolor{stringliteral}{        }\textcolor{keywordflow}{return} \{name: axis.limits \textcolor{keywordflow}{for} name, axis \textcolor{keywordflow}{in} self.\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a4cf92f2e92dd2da8d928c166bc55b800}{axes}}.items()\}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01533}01533 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01534}01534     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01535}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a19a92bfdb551a1002c964cefb485ea42}{01535}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a19a92bfdb551a1002c964cefb485ea42}{move\_by}}(self, delta: typing.Mapping[str, float]) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01536}01536         \textcolor{stringliteral}{"{}"{}"{}Move axes by the corresponding amounts.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01537}01537 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01538}01538 \textcolor{stringliteral}{        Args:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01539}01539 \textcolor{stringliteral}{            delta: map of axis name to the amount to be moved.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01540}01540 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01541}01541 \textcolor{stringliteral}{        .. code-\/block:: python}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01542}01542 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01543}01543 \textcolor{stringliteral}{            }\textcolor{comment}{\# Move 'x' axis by 10.2 units and the y axis by -\/5 units:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01544}01544             stage.move\_by(\{\textcolor{stringliteral}{'x'}: 10.2, \textcolor{stringliteral}{'y'}: -\/5\})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01545}01545 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01546}01546             \textcolor{comment}{\# The above is equivalent, but possibly faster than:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01547}01547             stage.axes[\textcolor{stringliteral}{'x'}].\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a19a92bfdb551a1002c964cefb485ea42}{move\_by}}(10.2)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01548}01548             stage.axes[\textcolor{stringliteral}{'y'}].\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a19a92bfdb551a1002c964cefb485ea42}{move\_by}}(-\/5)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01549}01549 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01550}01550         The axes will \textcolor{keywordflow}{not} move beyond :func:`limits`.  If `delta`}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01551}01551         would move an axis beyond it limit, no exception \textcolor{keywordflow}{is} raised.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01552}01552         Instead, the stage will move until the axis limit.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01553}01553 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01554}01554         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01555}01555 \textcolor{stringliteral}{        }\textcolor{comment}{\# TODO: implement a software fallback that moves the}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01556}01556         \textcolor{comment}{\# individual axis, for stages that don't have provide}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01557}01557         \textcolor{comment}{\# simultaneous move of multiple axes.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01558}01558         \textcolor{keywordflow}{raise} NotImplementedError()}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01559}01559 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01560}01560     \textcolor{preprocessor}{@abc.abstractmethod}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01561}\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a98bb8b3835293b7f59a677bcf60f91ca}{01561}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a98bb8b3835293b7f59a677bcf60f91ca}{move\_to}}(self, position: typing.Mapping[str, float]) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01562}01562         \textcolor{stringliteral}{"{}"{}"{}Move axes to the corresponding positions.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01563}01563 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01564}01564 \textcolor{stringliteral}{        Args:}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01565}01565 \textcolor{stringliteral}{            position: map of axis name to the positions to move to.}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01566}01566 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01567}01567 \textcolor{stringliteral}{        .. code-\/block:: python}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01568}01568 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01569}01569 \textcolor{stringliteral}{            }\textcolor{comment}{\# Move 'x' axis to position 8 and the y axis to position -\/5.3}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01570}01570             stage.move\_to(\{\textcolor{stringliteral}{'x'}: 8, \textcolor{stringliteral}{'y'}: -\/5.3\})}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01571}01571 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01572}01572             \textcolor{comment}{\# The above is equivalent to}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01573}01573             stage.axes[\textcolor{stringliteral}{'x'}].\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a98bb8b3835293b7f59a677bcf60f91ca}{move\_to}}(8)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01574}01574             stage.axes[\textcolor{stringliteral}{'y'}].\mbox{\hyperlink{classmicroscope_1_1abc_1_1_stage_a98bb8b3835293b7f59a677bcf60f91ca}{move\_to}}(-\/5.3)}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01575}01575 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01576}01576         The axes will \textcolor{keywordflow}{not} move beyond :func:`limits`.  If `positions`}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01577}01577         \textcolor{keywordflow}{is} beyond the limits, no exception \textcolor{keywordflow}{is} raised.  Instead, the}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01578}01578         stage will move until the axes limit.}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01579}01579 }
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01580}01580         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{abc_8py_source_l01581}01581 \textcolor{stringliteral}{        }\textcolor{keywordflow}{raise} NotImplementedError()}

\end{DoxyCode}
